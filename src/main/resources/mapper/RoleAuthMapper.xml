<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store.yd2team.common.mapper.RoleAuthMapper">

    <select id="selectRoleNameSuggest">
        SELECT    role_id  AS roleId,
                  vend_id  AS vendId,
                  role_nm  AS roleNm,
                  role_ty  AS roleTy,
                  role_dc  AS roleDc,
                  yn
        FROM      tb_role
        WHERE     yn = 'e1'
          AND     (vend_id = #{vendId} OR vend_id IS NULL)
          AND     role_nm LIKE '%' || #{keyword} || '%'
        ORDER BY  role_nm
    </select>

    <select id="selectRoleList">
        SELECT  role_id  AS roleId,
                vend_id  AS vendId,
                role_nm  AS roleNm,
                role_ty  AS roleTy,
                role_dc  AS roleDc,
                yn
        FROM    tb_role
        <where>
            <if test="vendId != null and vendId != ''">
                (vend_id = #{vendId} OR vend_id IS NULL)
            </if>
            <if test="roleNm != null and roleNm != ''">
                AND role_nm LIKE '%' || #{roleNm} || '%'
            </if>
            <if test="roleTy != null and roleTy != ''">
                AND role_ty = #{roleTy}
            </if>
            <if test="useYn != null and useYn!= ''">
                AND yn = #{useYn}
            </if>
        </where>
        ORDER BY vend_id NULLS FIRST, role_nm
    </select>

    <select id="selectMenuAuthList">
        SELECT     m.menu_id,                     
                   m.menu_nm,                     
                   m.module_id,                  
                   NVL(a.sel_yn,  'e2'),         
                   NVL(a.ins_yn,  'e2'),        
                   NVL(a.del_yn,  'e2')        
        FROM       tb_menu m
        LEFT JOIN  tb_auth a
               ON  a.menu_id = m.menu_id
              AND  a.role_id = #{roleId}
              AND  a.vend_id = #{vendId}
        WHERE      m.module_id = #{moduleId}
          AND      m.yn = 'e1'
          AND      (m.vend_id = #{vendId} OR m.vend_id IS NULL)
          AND      m.menu_url IS NOT NULL
        ORDER BY   m.sort_ord, m.menu_nm
    </select>
    
</mapper>