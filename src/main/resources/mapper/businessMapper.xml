<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store.yd2team.business.mapper.BusinessMapper">
	<!-- 휴면,이탈 기준조회 -->
	<select id="getChurnStdrList"
        parameterType="store.yd2team.business.service.ChurnStdrVO"
        resultType="store.yd2team.business.service.ChurnStdrVO">
  SELECT
      churn_risk_id      AS churnRiskId,
      cust_aggregate_no  AS custAggregateNo,
      vend_id            AS vendId,
      TRIM(sales_change) AS salesChange,
      ty                 AS ty,
      stdr_value         AS stdrValue,
      stdr_dc            AS stdrDc,
      yn                 AS yn,
      crea_dt            AS creaDt,
      crea_by            AS creaBy,
      updt_dt            AS updtDt,
      updt_by            AS updtBy
  FROM tb_churn_risk_stdr
  WHERE
    (
      vend_id = #{vendId}
      OR (
        (vend_id IS NULL OR vend_id = '')
        AND NOT EXISTS (
          SELECT 1
          FROM tb_churn_risk_stdr x
          WHERE x.vend_id = #{vendId}
        )
      )
    )
  ORDER BY crea_dt DESC, churn_risk_id
</select>


<!-- 휴면기준 등록 -->
<insert id="initChurnStdrByVend" parameterType="map">
  INSERT INTO tb_churn_risk_stdr (
      churn_risk_id,
      cust_aggregate_no,
      vend_id,
      sales_change,
      ty,
      stdr_value,
      stdr_dc,
      yn,
      crea_dt,
      crea_by
  )
  SELECT
      SEQ_TB_CHURN_RISK_STDR.NEXTVAL,
      c.cust_aggregate_no,
      #{vendId},
      c.sales_change,
      c.ty,
      c.stdr_value,
      c.stdr_dc,
      c.yn,
      SYSDATE,
      #{empId}
  FROM tb_churn_risk_stdr c
  WHERE (c.vend_id IS NULL OR c.vend_id = '')
    AND NOT EXISTS (
      SELECT 1
      FROM tb_churn_risk_stdr v
      WHERE v.vend_id = #{vendId}
    )
</insert>

	
	<!-- 휴면,이탈 기준 수정 -->
	<update id="updateChurnStdrByBizKey" parameterType="store.yd2team.business.service.ChurnStdrVO">
  UPDATE tb_churn_risk_stdr
  SET
      stdr_value = #{stdrValue},
      stdr_dc    = #{stdrDc},
      yn         = #{yn},
      updt_dt    = SYSDATE,
      updt_by    = #{updtBy}
  WHERE vend_id = #{vendId}
    AND sales_change = #{salesChange}
    AND ty = #{ty}
    AND cust_aggregate_no = #{custAggregateNo}
</update>


	
	<!-- 휴면,이탈고객 검색조회 -->
	<select id="getchurnRiskList" parameterType="store.yd2team.business.service.churnRiskVO">
	SELECT
		cust_aggregate_no as custAggregateNo,
		vend_id           as vendId,
		purc_stop_dt      as purcStopDt,
		avg_purc_cycle    as avgPurcCycle,
		sales_change      as salesChange,
		churn_risk_score  as churnRiskScore
	FROM
		tb_cust_aggregate
	 WHERE 1 = 1
	 AND vend_id = #{vendId}   <!-- 로그인 회사 기준 필터 -->
	    <if test="custAggregateNo != null and custAggregateNo != ''">
	         AND salesChange &gt;= TO_DATE(#{salesChange}, 'YYYY-MM-DD')
	    </if>
	    <if test="vendId != null and vendId != ''">
	        AND vendId LIKE '%' || #{vendId} || '%'
	    </if>
	    <if test="avgPurcCycle != null and avgPurcCycle != ''">
	        AND avgPurcCycle LIKE '%' || #{avgPurcCycle} || '%'
	    </if>
	    <if test="salesChange != null and salesChange != ''">
	         AND salesChange LIKE '%' || #{salesChange} || '%'
	    </if>
	    <if test="churnRiskScore != null and churnRiskScore != ''">
	        AND churnRiskScore LIKE '%' || #{churnRiskScore} || '%'
	    </if>
	</select>
		
<!-- 휴면, 이탈 조건별 점수화 -->
<select id="getMonthlySalesChange"
        parameterType="store.yd2team.business.service.MonthlySalesDTO"
        resultType="store.yd2team.business.service.MonthlySalesDTO">

WITH MONTHLY_SALES AS (
  SELECT
      a.CUSTcom_ID CUSTOMER_ID,
      TRUNC(a.SALE_DATE, 'MM') AS MONTH,
      SUM(d.supply_price) AS TOTAL_AMOUNT
  FROM tb_SALE a
  JOIN tb_sale_detail d ON a.sale_slip_no = d.sale_slip_no
  WHERE a.vend_id = #{vendId}
  GROUP BY a.CUSTcom_ID, TRUNC(a.SALE_DATE, 'MM')
),

LATEST_12 AS (
  SELECT CUSTOMER_ID, SUM(TOTAL_AMOUNT) AS AMT_12
  FROM MONTHLY_SALES
  WHERE MONTH &gt;= ADD_MONTHS(TRUNC(SYSDATE, 'MM'), -11)
  GROUP BY CUSTOMER_ID
),

PREV_12 AS (
  SELECT CUSTOMER_ID, SUM(TOTAL_AMOUNT) AS AMT_PREV_12
  FROM MONTHLY_SALES
  WHERE MONTH &lt;  ADD_MONTHS(TRUNC(SYSDATE, 'MM'), -11)
    AND MONTH &gt;= ADD_MONTHS(TRUNC(SYSDATE, 'MM'), -23)
  GROUP BY CUSTOMER_ID
),

TREND AS (
  SELECT
      a.CUSTOMER_ID,
      CASE
          WHEN b.AMT_PREV_12 IS NULL OR b.AMT_PREV_12 = 0 THEN 100
          ELSE ((a.AMT_12 - b.AMT_PREV_12) / b.AMT_PREV_12) * 100
      END AS GROWTH_RATE
  FROM LATEST_12 a
  LEFT JOIN PREV_12 b ON a.CUSTOMER_ID = b.CUSTOMER_ID
),

TREND_SCORE AS (
  SELECT
      CUSTOMER_ID,
      CASE
          WHEN GROWTH_RATE &gt;= 20 THEN 80
          WHEN GROWTH_RATE BETWEEN 5 AND 19 THEN 60
          WHEN GROWTH_RATE BETWEEN -5 AND 4 THEN 40
          WHEN GROWTH_RATE BETWEEN -20 AND -6 THEN 20
          ELSE 20
      END AS TREND_SCORE
  FROM TREND
),

LAST_PURCHASE AS (
  SELECT
      a.CUSTCOM_ID CUSTOMER_ID,
      MAX(a.SALE_DATE) AS LAST_DATE,
      TRUNC(SYSDATE - MAX(a.SALE_DATE)) AS DAYS_SINCE
  FROM tb_sale a
  WHERE a.vend_id = #{vendId}
  GROUP BY a.CUSTCOM_ID
),

RECENCY_SCORE AS (
  SELECT
      CUSTOMER_ID,
      LAST_DATE,
      DAYS_SINCE,
      CASE
          WHEN DAYS_SINCE &lt;= 30  THEN 80
          WHEN DAYS_SINCE &lt;= 60  THEN 60
          WHEN DAYS_SINCE &lt;= 90  THEN 30
          WHEN DAYS_SINCE &lt;= 180 THEN 10
          ELSE 10
      END AS REC_SCORE
  FROM LAST_PURCHASE
),

FREQ AS (
  SELECT
      a.CUSTCOM_ID CUSTOMER_ID,
      SUM(CASE WHEN a.SALE_DATE &gt;= ADD_MONTHS(SYSDATE, -3) THEN 1 ELSE 0 END) AS FREQ_3,
      SUM(CASE WHEN a.SALE_DATE &gt;= ADD_MONTHS(SYSDATE, -12) THEN 1 ELSE 0 END) AS FREQ_12
  FROM TB_SALE a
  WHERE a.vend_id = #{vendId}
  GROUP BY a.CUSTCOM_ID
),

FREQ_SCORE AS (
  SELECT
      CUSTOMER_ID,
      CASE
          WHEN FREQ_12 = 0 THEN 20
          WHEN (FREQ_3 / (FREQ_12/12*3)) &gt;= 1.5 THEN 90
          WHEN (FREQ_3 / (FREQ_12/12*3)) &gt;= 0.8 THEN 60
          ELSE 30
      END AS FREQ_SCORE
  FROM FREQ
)

SELECT
  t.CUSTOMER_ID  AS customerId,
  c.CUSTCOM_NAME AS custcomName,

  r.LAST_DATE    AS lastDate,
  r.DAYS_SINCE   AS daysSince,

  t.TREND_SCORE  AS trendScore,
  r.REC_SCORE    AS recScore,
  f.FREQ_SCORE   AS freqScore,

  (t.TREND_SCORE * 0.4) + (r.REC_SCORE * 0.4) + (f.FREQ_SCORE * 0.2) AS finalScore,

  CASE
      WHEN ((t.TREND_SCORE * 0.4) + (r.REC_SCORE * 0.4) + (f.FREQ_SCORE * 0.2)) &gt;= 80 THEN '이탈위험 고객'
      WHEN ((t.TREND_SCORE * 0.4) + (r.REC_SCORE * 0.4) + (f.FREQ_SCORE * 0.2)) &gt;= 60 THEN '주의 고객'
      WHEN ((t.TREND_SCORE * 0.4) + (r.REC_SCORE * 0.4) + (f.FREQ_SCORE * 0.2)) &gt;= 40 THEN '휴먼 고객'
      ELSE '정상 고객'
  END AS customerStatus

FROM TREND_SCORE t
JOIN RECENCY_SCORE r ON t.CUSTOMER_ID = r.CUSTOMER_ID
JOIN FREQ_SCORE    f ON t.CUSTOMER_ID = f.CUSTOMER_ID
JOIN TB_CUSTCOM    c ON t.CUSTOMER_ID = c.CUSTCOM_ID

WHERE 1 = 1

<if test="customerId != null and customerId != ''">
  AND t.CUSTOMER_ID LIKE '%' || #{customerId} || '%'
</if>

<if test="customerStatus != null and customerStatus != ''">
  AND (
      CASE
          WHEN ((t.TREND_SCORE * 0.4) + (r.REC_SCORE * 0.4) + (f.FREQ_SCORE * 0.2)) &gt;= 80 THEN '이탈위험 고객'
          WHEN ((t.TREND_SCORE * 0.4) + (r.REC_SCORE * 0.4) + (f.FREQ_SCORE * 0.2)) &gt;= 60 THEN '주의 고객'
          WHEN ((t.TREND_SCORE * 0.4) + (r.REC_SCORE * 0.4) + (f.FREQ_SCORE * 0.2)) &gt;= 40 THEN '휴먼 고객'
          ELSE '정상 고객'
      END LIKE '%' || #{customerStatus} || '%'
  )
</if>

<if test="trendScore != null">
  AND t.TREND_SCORE &gt;= #{trendScore}
</if>
<if test="recScore != null">
  AND r.REC_SCORE &gt;= #{recScore}
</if>
<if test="freqScore != null">
  AND f.FREQ_SCORE &gt;= #{freqScore}
</if>
<if test="finalScore != null">
  AND ((t.TREND_SCORE * 0.4) + (r.REC_SCORE * 0.4) + (f.FREQ_SCORE * 0.2)) &gt;= #{finalScore}
</if>

ORDER BY finalScore DESC

</select>








<!-- 잠재고객 전체조회 -->
 <select id="getList" resultType="store.yd2team.business.service.BusinessVO">
     SELECT
	            potential_info_no  as potentialInfoNo,
	            potential_cond_no  as potentialCondNo,
	            vend_id            as vendId,
	            rank               as rank,
	            vend_nm            as vendNm,
	            industry_type      as industryType,
	            company_size       as companySize,
	            region             as region,
	            establish_date AS establishDate
     FROM 	tb_potential_cust_list
    ORDER BY potential_info_no desc
 </select>
	<!-- 잠재고객 기준상세목록 조회 -->
	<select id="getPotentialStdrDetailList"
	      parameterType="store.yd2team.business.service.PotentialStdrVO"
	      resultType="store.yd2team.business.service.PotentialStdrVO">
			  SELECT
			      STDR_DETAIL_ID   AS stdrDetailId,
			      STDR_ID          AS stdrId,
			      VEND_ID          AS vendId,
			      STDR_ITEAM_INFO  AS stdrIteamInfo,
			      INFO_SCORE       AS infoScore,
			      CREA_DT          AS creaDt,
			      CREA_BY          AS creaBy,
			      UPDT_DT          AS updtDt,
			      UPDT_BY          AS updtBy
			  FROM TB_POTENTIAL_STDR_DETAIL
			  WHERE
			    (
			      VEND_ID = #{vendId}
			      OR (
			        (VEND_ID IS NULL OR VEND_ID = '')
			        AND NOT EXISTS (
			          SELECT 1
			          FROM TB_POTENTIAL_STDR_DETAIL x
			          WHERE x.VEND_ID = #{vendId}
			        )
			      )
			    )
			  ORDER BY STDR_ID, STDR_DETAIL_ID
	</select>

	
	<!-- 잠재고객 조건상세목록 등록 -->
	<insert id="insertPotentialStdrDetail"
       parameterType="store.yd2team.business.service.PotentialStdrVO">
   INSERT INTO TB_POTENTIAL_STDR_DETAIL (
         STDR_DETAIL_ID
       , STDR_ID
       , VEND_ID
       , STDR_ITEAM_INFO
       , INFO_SCORE
       , CREA_DT
       , CREA_BY
   ) VALUES (
         #{stdrDetailId}
       , #{stdrId}
       , #{vendId}
       , #{stdrIteamInfo}
       , #{infoScore}
       , SYSDATE
       , #{creaBy}
   )
</insert>
	<insert id="initPotentialStdrByVend" parameterType="map">
  INSERT INTO TB_POTENTIAL_STDR_DETAIL
  (
      STDR_DETAIL_ID,
      STDR_ID,
      VEND_ID,
      STDR_ITEAM_INFO,
      INFO_SCORE,
      CREA_DT,
      CREA_BY
  )
  SELECT
      d.STDR_DETAIL_ID,
      d.STDR_ID,
      #{vendId},
      d.STDR_ITEAM_INFO,
      d.INFO_SCORE,
      SYSDATE,
      #{empId}
  FROM TB_POTENTIAL_STDR_DETAIL d
  WHERE (d.VEND_ID IS NULL OR d.VEND_ID = '')
    AND NOT EXISTS (
      SELECT 1
      FROM TB_POTENTIAL_STDR_DETAIL x
      WHERE x.VEND_ID = #{vendId}
    )
</insert>

<update id="updatePotentialStdrDetail"
      parameterType="store.yd2team.business.service.PotentialStdrVO">
  UPDATE TB_POTENTIAL_STDR_DETAIL
     SET STDR_ITEAM_INFO = #{stdrIteamInfo},
         INFO_SCORE      = #{infoScore},
         UPDT_DT         = SYSDATE,
         UPDT_BY         = #{updtBy}
   WHERE STDR_DETAIL_ID  = #{stdrDetailId}
     AND VEND_ID         = #{vendId}
</update>

	<!-- 잠재고객 기준상세목록 삭제 -->
	<delete id="deletePotentialStdr" parameterType="store.yd2team.business.service.PotentialStdrVO">
	    DELETE FROM TB_POTENTIAL_STDR_DETAIL
	    WHERE STDR_DETAIL_ID = #{stdrDetailId}
	      AND VEND_ID        = #{vendId}
	</delete>
	
	<!-- 공공데이터 insert -->
	<insert id="insertPotential" parameterType="store.yd2team.business.service.BusinessVO">
	    INSERT INTO TB_POTENTIAL_CUST_LIST (
	        potential_info_no,
	        potential_cond_no,
	        vend_id,
	        rank,
	        vend_nm,
	        industry_type,
	        company_size,
	        region,
	        establish_date
	    ) VALUES (
	        #{potentialInfoNo},
	        seq_potential_cond_no.nextval,   <!-- ★ 여기 수정 -->
	       'CUST' || LPAD(seq_vend_id.NEXTVAL, 3, '0'),
	        seq_rank.nextval,
	        #{vendNm},
	        #{industryType},
	        #{companySize},
	        #{region},
	        to_date(#{establishDate}, 'yyyy-mm-dd')
	    )
	</insert>
	 
 <!-- 공공데이터 고객 건수 카운트 -->
 <select id="existsPotentialInfoNo">
	    SELECT COUNT(*)
	    FROM tb_potential_cust_list
	    WHERE potential_info_no = #{potentialInfoNo}
 </select>
 <!-- 잠재고객검색조회 -->
 <select id="getBusinessList" parameterType="store.yd2team.business.service.BusinessVO"
       resultType="store.yd2team.business.service.BusinessVO">
   SELECT
       p.POTENTIAL_INFO_NO  AS potentialInfoNo,
       p.RANK               AS rank,
       p.VEND_ID            AS vendId,
       p.VEND_NM            AS vendNm,
       p.INDUSTRY_TYPE      AS industryType,
       p.COMPANY_SIZE       AS companySize,
       p.ESTABLISH_DATE     AS establishDate,
       p.REGION             AS region,
       NVL(c.CONTACT_CNT, 0) AS contactCnt
   FROM TB_POTENTIAL_CUST_LIST p
   LEFT JOIN (
       SELECT POTENTIAL_INFO_NO, COUNT(*) AS CONTACT_CNT
       FROM TB_CONTACT
       GROUP BY POTENTIAL_INFO_NO
   ) c
     ON c.POTENTIAL_INFO_NO = p.POTENTIAL_INFO_NO
   WHERE 1=1
   <if test="industryType != null and industryType != ''">
       AND p.INDUSTRY_TYPE LIKE '%' || #{industryType} || '%'
   </if>
   <if test="companySize != null and companySize != ''">
       AND p.COMPANY_SIZE LIKE '%' || #{companySize} || '%'
   </if>
   <if test="region != null and region != ''">
       AND p.REGION LIKE '%' || #{region} || '%'
   </if>
   <if test="startEstablishDate != null and startEstablishDate != ''">
       AND p.ESTABLISH_DATE &gt;= TO_DATE(#{startEstablishDate}, 'YYYY-MM-DD')
   </if>
   <if test="endEstablishDate != null and endEstablishDate != ''">
       AND p.ESTABLISH_DATE &lt;= TO_DATE(#{endEstablishDate}, 'YYYY-MM-DD')
   </if>
   ORDER BY p.RANK
</select>
	
	
	<!-- 접촉사항조회-->
	<select id="getAction" parameterType="store.yd2team.business.service.ContactVO">
			SELECT  contact_no contactNo,
			        potential_info_no potentialInfoNo,
			        vend_id vendId,
			        contact_dt contactDt,
			        contact_manager contactManager,
			        contact_way contactWay,
			        contact_cntn contactCntn
			FROM    tb_contact
	</select>
	
	<!-- 리드분석조회 -->
	<select id="getLeadGenerar" parameterType="store.yd2team.business.service.ContactVO">
			SELECT  LEAD_NO,
			        VEND_ID,
			        LEAD_DT,
			        LEAD_MANAGER,
			        REQUIRED_DT,
			        COMPETITOR_YN,
			        BUDGET_AVAIL_YN
			FROM    tb_lead;
	</select>
	
	<!-- 잠재고개객 각 항목 선택-->
	<!-- 접촉사항조회 -->
	<select id="selectContactListByVend"
       parameterType="store.yd2team.business.service.ContactVO"
       resultType="store.yd2team.business.service.ContactVO">
   SELECT
       CONTACT_NO        AS contactNo,
       POTENTIAL_INFO_NO AS potentialInfoNo,
       VEND_ID           AS vendId,
       TO_CHAR(CONTACT_DT, 'YYYY-MM-DD') AS contactDt,
       CONTACT_MANAGER   AS contactManager,
       CONTACT_WAY       AS contactWay,
       CONTACT_CNTN      AS contactCntn,
       CREA_DT           AS creaDt,
       CREA_BY           AS creaBy,
       UPDT_DT           AS updtDt,
       UPDT_BY           AS updtBy
   FROM TB_CONTACT
   WHERE VEND_ID = #{vendId}
     AND POTENTIAL_INFO_NO = #{potentialInfoNo}
   ORDER BY CONTACT_DT DESC
</select>
   <!-- 접촉사항 등록 -->
  <insert id="insertContact"
          parameterType="store.yd2team.business.service.ContactVO">
   INSERT INTO TB_CONTACT
   (
       CONTACT_NO,
       POTENTIAL_INFO_NO,
       VEND_ID,
       CONTACT_DT,
       CONTACT_MANAGER,
       CONTACT_WAY,
       CONTACT_CNTN,
       CREA_DT,
       CREA_BY
   )
   VALUES
   (
       CONTACT_SEQ.NEXTVAL,
       #{potentialInfoNo},
       #{vendId},
       TO_DATE(#{contactDt}, 'YYYY-MM-DD'),
       #{contactManager},
       #{contactWay},
       #{contactCntn},
       SYSDATE,
       #{creaBy}
   )
  </insert>
 	<!-- 접촉사항 수정 -->
	<update id="updateContact"
		        parameterType="store.yd2team.business.service.ContactVO">
		  UPDATE TB_CONTACT
	       SET CONTACT_DT      = TO_DATE(#{contactDt}, 'YYYY-MM-DD'),
	           CONTACT_MANAGER = #{contactManager},
	           CONTACT_WAY     = #{contactWay},
	           CONTACT_CNTN    = #{contactCntn},
	           UPDT_DT         = SYSDATE,
	           UPDT_BY         = #{updtBy}
	     WHERE CONTACT_NO      = #{contactNo}
		</update>
	
	<!-- 리드내역조회 -->
	<select id="getLeadListByVend"
       parameterType="store.yd2team.business.service.LeadVO" resultType="store.yd2team.business.service.LeadVO">
	    SELECT
	        LEAD_NO           AS leadNo,
	        POTENTIAL_INFO_NO AS potentialInfoNo,
	        VEND_ID           AS vendId,
	        TO_CHAR(LEAD_DT, 'YYYY-MM-DD') AS leadDt,
	        LEAD_MANAGER      AS leadManager,
	        TO_CHAR(REQUIRED_DT, 'YYYY-MM-DD') AS requiredDt,
	        COMPETITOR_YN     AS competitorYn,
	        BUDGET_AVAIL_YN   AS budgetAvailYn,
	        CREA_DT           AS creaDt,
	        CREA_BY           AS creaBy,
	        UPDT_DT           AS updtDt,
	        UPDT_BY           AS updtBy
	    FROM TB_LEAD
	    WHERE VEND_ID = #{vendId}
	      AND POTENTIAL_INFO_NO = #{potentialInfoNo}
	    ORDER BY LEAD_DT DESC
	
	</select>
   <!-- 리드내역 등록 -->
  <insert id="insertLead"
          parameterType="store.yd2team.business.service.LeadVO">
      INSERT INTO TB_LEAD
				(
				    LEAD_NO,
				    POTENTIAL_INFO_NO,
				    VEND_ID,
				    LEAD_DT,
				    LEAD_MANAGER,
				    REQUIRED_DT,
				    COMPETITOR_YN,
				    BUDGET_AVAIL_YN,
				    CREA_DT,
				    CREA_BY
				)
				VALUES
				(
				    SEQ_TB_LEAD_NO.NEXTVAL,
				    #{potentialInfoNo},
				    #{vendId},
				    TO_DATE(#{leadDt}, 'YYYY-MM-DD'),
				    #{leadManager},
				    TO_DATE(#{requiredDt}, 'YYYY-MM-DD'),
				    SUBSTR(#{competitorYn}, 1, 1),
				    SUBSTR(#{budgetAvailYn}, 1, 1),
				    SYSDATE,
				    #{creaBy}
				)
  </insert>
 	<!-- 리드내역 수정 -->
	<update id="updateLead"
		        parameterType="store.yd2team.business.service.LeadVO">
			UPDATE
				TB_LEAD
			SET
			    LEAD_MANAGER    = #{leadManager},
			    REQUIRED_DT     = TO_DATE(#{requiredDt}, 'YYYY-MM-DD'),
			    COMPETITOR_YN   = SUBSTR(#{competitorYn}, 1, 1),
			    BUDGET_AVAIL_YN = SUBSTR(#{budgetAvailYn}, 1, 1),
			    UPDT_DT         = SYSDATE,
			    UPDT_BY         = #{updtBy}
			WHERE
				LEAD_NO = #{leadNo}
	</update>
	
	<!-- 데모내역조회 -->
	<select id="getDemoListByVend"
       parameterType="store.yd2team.business.service.DemoVO" resultType="store.yd2team.business.service.DemoVO">
	    SELECT
	        DEMO_QUOTATIO_NO  AS demoQuotatioNo,
	        POTENTIAL_INFO_NO AS potentialInfoNo,
	        VEND_ID           AS vendId,
	        TO_CHAR(DEMO_QUOTATIO_DT, 'YYYY-MM-DD') AS demoQuotatioDt,
	        DEMO_MANAGER      AS demoManager,
	        DEMO_DC           AS demoDc,
	        CUST_REACTION     AS custReaction,
	        SAMPLE_PRIVIDE    AS samplePrivide,
	        CUST_QY           AS custQy,
	        CUST_DISCOUNT     AS custDiscount,
	        CUST_DELIVERY     AS custDelivery,
	        CREA_DT           AS creaDt,
	        CREA_BY           AS creaBy,
	        UPDT_DT           AS updtDt,
	        UPDT_BY           AS updtBy
	    FROM TB_DEMO_QUOTATIO
	    WHERE VEND_ID = #{vendId}
	      AND POTENTIAL_INFO_NO = #{potentialInfoNo}
	    ORDER BY DEMO_QUOTATIO_DT DESC
</select>
   <!-- 데모내역 등록 -->
  <insert id="insertDemo"
          parameterType="store.yd2team.business.service.DemoVO">
      INSERT INTO TB_DEMO_QUOTATIO
   (
       DEMO_QUOTATIO_NO,
       POTENTIAL_INFO_NO,
       VEND_ID,
       DEMO_QUOTATIO_DT,
       DEMO_MANAGER,
       DEMO_DC,
       CUST_REACTION,
       SAMPLE_PRIVIDE,
       CUST_QY,
       CUST_DISCOUNT,
       CUST_DELIVERY,
       CREA_DT,
       CREA_BY
   )
   VALUES
   (
       SEQ_TB_DEMO_QUOTATIO_NO.NEXTVAL,
       #{potentialInfoNo},
       #{vendId},
       TO_DATE(#{demoQuotatioDt}, 'YYYY-MM-DD'),
       #{demoManager},
       #{demoDc},
       #{custReaction},
       #{samplePrivide},
       #{custQy},
       #{custDiscount},
       #{custDelivery},
       SYSDATE,
       #{creaBy}
   )
  </insert>
 	<!-- 데모내역 수정 -->
	<update id="updateDemo"
		        parameterType="store.yd2team.business.service.DemoVO">
		UPDATE TB_DEMO_QUOTATIO
	       SET DEMO_MANAGER    = #{demoManager},
	           DEMO_DC         = #{demoDc},
	           CUST_REACTION   = #{custReaction},
	           SAMPLE_PRIVIDE  = #{samplePrivide},
	           CUST_QY         = #{custQy},
	           CUST_DISCOUNT   = #{custDiscount},
	           CUST_DELIVERY   = #{custDelivery},
	           UPDT_DT         = SYSDATE,
	           UPDT_BY         = #{updtBy}
	     WHERE DEMO_QUOTATIO_NO = #{demoQuotatioNo}
		</update>
	
</mapper>


