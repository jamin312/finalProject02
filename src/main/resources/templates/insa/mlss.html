<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>mlss.html</title>

<style>
.form-select {
	color: #000 !important;
}
/* ì¶”ê°€ CSS */
.readonly-input[readonly] {
	background-color: #e9ecef; /* Bootstrap ê¸°ë³¸ disabled ìƒ‰ìƒ */
	cursor: not-allowed; /* ë§ˆìš°ìŠ¤ ì»¤ì„œë„ ì…ë ¥ ë¶ˆê°€ ëŠë‚Œ */
}

.stIsShow {
	display: none;
}

.menu-item {
	cursor: pointer; /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ì†ê°€ë½ ëª¨ì–‘ */
}

.fw-bold {
font-weight: bold;
}

.btn-group .btn:not(:last-child) {
    border-right-width: 0 !important;
}



</style>
</head>
<body layout:fragment="content">
	<div class="row">
		<div class="col-md-12">
			<div class="card mb-3">
				<!-- ì¹´ë“œ í—¤ë” : ì œëª© + ì´ˆê¸°í™”/ì¡°íšŒ ë²„íŠ¼ -->
				<div class="card-header">
					<div class="card-header-left">
						<h5 class="card-title">í‰ê°€ ì§„í–‰ í˜„í™© ë°•ìŠ¤</h5>
					</div>					
				</div>
				<div class="card-body">

					<div class="row mb-2">
						<div class="col-md-2">
							<label class="form-label">ë³¸ì¸ í‰ê°€ ì™„ë£Œ ì—¬ë¶€</label> <input type="text"
								id="selfSt" value="0 / 3" class="form-control" />
						</div>
						<div class="col-md-2">
							<label class="form-label">ìƒì‚¬ í‰ê°€ ì™„ë£Œ ì—¬ë¶€</label> <input type="text"
								id="suprrSt" th:value="|0 / ${evaleRelateUpr.size()}|" class="form-control" />
						</div>
						<div class="col-md-2">
							<label class="form-label">ë™ë£Œ í‰ê°€ ì™„ë£Œ ì—¬ë¶€</label> <input type="text"
								id="crkSt" th:value="|0 / ${evaleRelateLwr.size()}|" class="form-control"/>
						</div>
						<div class="col-md-6">
								<label for="userName" class="form-label">ê¸°ê°„</label>
								<div class="d-flex align-items-center js-date-range">

										<!-- ì‹œì‘ì¼ -->
										<div class="input-group date">
											<input type="text"
												class="form-control datepicker js-date-range-start"
												th:value="${#dates.format(evlBeginDt, 'yyyy-MM-dd')}" placeholder="ì‹œì‘ì¼"> <span
												class="input-group-text js-date-range-icon-start"> <i
												class="bi bi-calendar"></i>
											</span>
										</div>

										<span class="mx-1 fw-bold fs-5">~</span>

										<!-- ì¢…ë£Œì¼ -->
										<div class="input-group date ms-2">
											<input type="text"
												class="form-control datepicker js-date-range-end"
												th:value="${#dates.format(evlEndDt, 'yyyy-MM-dd')}" placeholder="ì¢…ë£Œì¼"> <span
												class="input-group-text js-date-range-icon-end"> <i
												class="bi bi-calendar"></i>
											</span>
										</div>

									</div>
							</div>

					</div>
				</div>
			</div>
		</div>
	</div>


	<div class="row">
		<!-- <div class="col-md-2">
			<div class="card">
				<div class="menu-item" onclick="chTitle(this)">
					<i class="fa fa-edit"></i>ë³¸ì¸ í‰ê°€
				</div>
				<div class="menu-item" onclick="chTitle(this)">
					<i class="fa fa-edit"></i>ìƒì‚¬ í‰ê°€
				</div>
				<div class="menu-item" onclick="chTitle(this)">
					<i class="fa fa-edit"></i>ë™ë£Œ í‰ê°€
				</div>
				<div class="menu-item" onclick="chTitle(this)">
					<i class="fa fa-edit"></i>ê²°ê³¼ì§€ í™•ì¸
				</div>
			</div>
		</div> -->
		<div class="col-md-10">
		<div class="btn-group" role="group" aria-label="Basic radio toggle button group">
  <input type="radio"  class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" checked>
  <label class="btn btn-outline-primary fw-bold" onclick="chTitle(this)" for="btnradio1"><i class="fa fa-edit"></i>ë³¸ì¸ í‰ê°€</label>

  <input type="radio"  class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">
  <label class="btn btn-outline-primary fw-bold" onclick="chTitle(this)" for="btnradio2"><i class="fa fa-edit"></i>ìƒì‚¬ í‰ê°€</label>

  <input type="radio"  class="btn-check" name="btnradio" id="btnradio3" autocomplete="off">
  <label class="btn btn-outline-primary fw-bold" onclick="chTitle(this)" for="btnradio3"><i class="fa fa-edit"></i>ë™ë£Œ í‰ê°€</label>

  <input type="radio"  class="btn-check" name="btnradio" id="btnradio4" autocomplete="off">
  <label class="btn btn-outline-primary fw-bold" onclick="chTitle(this)" for="btnradio4"><i class="fa fa-edit"></i>ê²°ê³¼ì§€ í™•ì¸</label>
</div>
		</div>
		<!-- ê²€ìƒ‰ì¡°ê±´ -->
		<div class="col-md-12">
			<!-- ì‚¬ì›ëª©ë¡ -->
			<div id="mlssUser" class="card">
				<!-- ì¹´ë“œ í—¤ë” : ì œëª© + ì´ˆê¸°í™”/ì¡°íšŒ ë²„íŠ¼ -->
				<div class="card-header d-flex justify-content-between align-items-center">
					<div class="card-header-left d-flex align-items-center">
						<!-- collapse í† ê¸€ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½ -->
						<h5 class="card-title mb-0 me-2" id="collapseToggle">ë³¸ì¸ í‰ê°€</h5>
						<select id="evaleRelate1" class="form-select form-select-sm w-auto">
								<th:block th:each="val : ${evaleRelateUpr}">
									<option class="clsf" th:value="${val.mlssEmpId}" th:text="${val.nm}"></option>									
								</th:block>																															
							</select>													
						<select id="evaleRelate2" class="form-select form-select-sm w-auto">								
								<th:block th:each="val : ${evaleRelateLwr}">
									<option class="clsf" th:value="${val.mlssEmpId}" th:text="${val.nm}"></option>																	
								</th:block>																								
							</select>													
					</div>
					<div class="card-header-right">						
						<button id="mlssUserRegist" type="button" class="btn btn-outline-dark">ì œì¶œ</button>						
					</div>
				</div>
				
					<div class="card-body">						
						<div style="height: 530px; overflow:auto;" >
						<h5 id="yeocRyangGrp" class="card-title">ì—­ëŸ‰ ê·¸ë£¹ë³„ í‰ê°€ í•­ëª©</h5>
						<p>ì§ë¬´ ì—­ëŸ‰</p>
						<div id="toastGrid" style="margin: 20px;"></div>
						<p>í˜‘ì—… ì—­ëŸ‰</p>
						<div id="toastGrid2" style="margin: 20px;"></div>
						<p>ìê¸°ê´€ë¦¬ ì—­ëŸ‰</p>
						<div id="toastGrid3" style="margin: 20px;"></div>
						</div>
					</div>
				
			</div>
			<div id="mlssResult" class="card stIsShow" style="height: 550px; overflow-y:auto; overflow-x:hidden;">
				<div class="row mb-2">
					<div class="col-md-6">
						<div id="radar" style="width: 400px; height: 400px;"></div>
					</div>
					<div class="col-md-6">
						<div id="pie" style="width: 400px; height: 400px;"></div>
					</div>
				</div>
				<div class="row mb-2">
				<div class="col-md-12">
				<div id="toastGrid4" style="margin: 20px;"></div>
				</div>
				</div>
				<div class="row mb-2">
				<div class="col-md-12">
				<div id="column" style="width: 900px; height: 400px;"></div>
				</div>
				</div>


			</div>
		</div>
	</div>
	<script th:inline="javascript">	
	$("#evaleRelate1").hide();
	$("#evaleRelate2").hide();
	let mlssEmpId ="";
	let resultFinalData = null;
function chTitle(el) {
	 // div ì•ˆì˜ í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (ì•„ì´ì½˜ ì œì™¸)
	const text = $(el).text().trim();
    if (text === "ê²°ê³¼ì§€ í™•ì¸") {
        $("#mlssUser").addClass("stIsShow");
        $("#mlssResult").removeClass("stIsShow");
        $.ajax({
      	  url: "/mlssFinalResult",                // ìš”ì²­ URL
      	  type: "get"                     // GET ë°©ì‹ (fetch ì½”ë“œì™€ ë™ì¼)      	  
      	})
      	.done((result) => {	
      		resultFinalData = result;
      		console.log(resultFinalData);
      	// ğŸ“Œ ë°ì´í„° ë¡œë”©ì´ ëë‚œ í›„ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            showRadarChart();  
      	})
      	.fail((error) => {
      	  console.error(error);
      	  alert("ë°ì´í„° ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
      	}); 
    } else {
        $("#mlssUser").removeClass("stIsShow");
        $("#mlssResult").addClass("stIsShow");
    }    
    
    // a íƒœê·¸ì˜ í…ìŠ¤íŠ¸ ë³€ê²½    
    $("#collapseToggle").text(text);    
    if ($("#collapseToggle").text() == "ìƒì‚¬ í‰ê°€") {
        $("#evaleRelate1").show();        
        $("#evaleRelate2").hide();   
        mlssEmpId = $("#evaleRelate1").val();
    } else if($("#collapseToggle").text() == "ë™ë£Œ í‰ê°€"){
    	$("#evaleRelate1").hide();    	
    	$("#evaleRelate2").show();   
    	mlssEmpId = $("#evaleRelate2").val();
    } else {
    	$("#evaleRelate1").hide();
    	$("#evaleRelate2").hide();
    	mlssEmpId = [[${mlssEmpId}]];    	
    }
    
    callMlssChkJohoe(mlssEmpId);
    
	/* // ğŸ“Œ divê°€ í™”ë©´ì— ë³´ì´ëŠ” ìˆœê°„ ì°¨íŠ¸ë¥¼ ìƒì„±
       if (!radarChart) {
           showRadarChart();
       } else {		        	
       	// ğŸ“Œ divê°€ ë³´ì´ëŠ” ìˆœê°„ ì°¨íŠ¸ ìƒì„±
           setTimeout(() => {
               showRadarChart();
           }, 50); // í™”ë©´ ê°±ì‹  í›„ ì‹¤í–‰
           // ğŸ“Œ ì´ë¯¸ ìƒì„±í•œ ì°¨íŠ¸ë¼ë©´ ê°±ì‹       
	
           radarChart.resize();   
           pieChart.resize();   
           columnChart.resize();   
       } */
	
	
       
	
}

//select ë³€ê²½ ì´ë²¤íŠ¸ì—ë„ ì—°ê²°

$("#evaleRelate1, #evaleRelate2").on("change", function() {
    mlssEmpId = $(this).val();
    //console.log(mlssEmpId);
    callMlssChkJohoe(mlssEmpId);
});





function callMlssChkJohoe(mlssEmpId) {
	console.log("ëª¨ë‚˜ì˜¤ë‹ˆ"+mlssEmpId);
	//ë¼ë””ì˜¤ ë²„íŠ¼ ì¤‘ checked ë˜ì–´ ìˆëŠ” ê²ƒë§Œ ì„ íƒ
	$("input[type=radio]:checked").prop("checked", false);
	$.ajax({
	  url: "/selectMlssChkJohoe",                // ìš”ì²­ URL
	  type: "get",                     // GET ë°©ì‹ (fetch ì½”ë“œì™€ ë™ì¼)
	  data: {mlssEmpId : mlssEmpId,
	  	empId: [[${empId}]]}
	})
	.done((result) => {	
		console.log(result);   
		getdbData(result);
	})
	.fail((error) => {
	  console.error(error);
	  alert("ë°ì´í„° ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
	}); 
}

function makeRadarData(iemList, myWrterList, evaleRelate) {
	  // ê²°ê³¼ ë°°ì—´ (ì§ë¬´, í˜‘ì—…, ìê¸°ê´€ë¦¬ ìˆœì„œ)
	  const result = [];

	  // ê° ê·¸ë£¹ë³„ ì²˜ë¦¬
	  for (const groupName of ["ì§ë¬´ ì—­ëŸ‰", "í˜‘ì—… ì—­ëŸ‰", "ìê¸°ê´€ë¦¬ ì—­ëŸ‰"]) {
	    const items = iemList[groupName]; // í•´ë‹¹ ê·¸ë£¹ì˜ í•­ëª©ë“¤

	    // í•´ë‹¹ ê·¸ë£¹ì˜ ì ìˆ˜ ëª¨ìœ¼ê¸°
	    const scores = items.map(item => {
	      // myWrterListì—ì„œ ê°™ì€ mlssIemId + evaleRelateì¸ ì ìˆ˜ ì°¾ê¸°
	      const wrter = myWrterList.find(
	        w => w.mlssIemId === item.mlssIemId && w.evaleRelate === evaleRelate
	      );
	      return wrter ? wrter.score : null;
	    }).filter(s => s !== null);

	    // í‰ê·  ê³„ì‚°
	    const avg = scores.length > 0
	      ? scores.reduce((sum, s) => sum + s, 0) / scores.length
	      : 0;

	    result.push(avg);
	  }

	  return { name: evaleRelate, data: result };
	}


class ScoreRadioRenderer {
	  constructor(props) {
	    this.el = document.createElement('div');	    
	    const rowKey = props.rowKey;	   
	    const radioName = props.grid.store.data.filteredRawData[rowKey].mlssIemId;

	    this.el.innerHTML = [1,2,3,4,5].map(v =>
	      `<label><input type="radio" name="${radioName}" value="${v}">${v}</label>`
	    ).join(' ');

	    this.el.querySelectorAll('input[type="radio"]').forEach(input => {
	      input.addEventListener('change', (e) => {
	        const value = Number(e.target.value);
	        props.grid.setValue(rowKey, 'score', value);
	        //console.log('row', rowKey, 'score', value);
	      });
	    });
	  }

	  getElement() {
	    return this.el;
	  }
	}
			
let gridColums = [
    { header: 'ID', name: 'mlssIemId', hidden: true },
    { header: 'í‰ê°€ í•­ëª©', name: 'mlssIem', sortable: true, align:'center'},
    {
    	  header: 'ì ìˆ˜',
    	  name: 'score',
    	  align: 'center',
    	  renderer: { type: ScoreRadioRenderer }
    	}
];

			let grpTag = $("#yeocRyangGrp");
			let isRegist = 0;
			$("#mlssUserRegist").on("click", () => {				
				let payLoad = {};				
				let master = {};				
				let datas = [...grid.getData(), ...grid2.getData(), ...grid3.getData()];	
				
				for(let data of datas) {
					$(`input[name="${data.mlssIemId}"]`).each(function() {
						  if ($(this).prop("checked")) {
						    data["score"] = Number($(this).val());						    
						    data["empId"] = [[${empId}]];			    
						    if($("#collapseToggle").text() == "ë³¸ì¸ í‰ê°€") {
						    	data["evaleRelate"] = "ë³¸ì¸";
						    	data["mlssEmpId"] = [[${mlssEmpId}]];
						    }else if($("#collapseToggle").text() == "ìƒì‚¬ í‰ê°€"){
						    	data["evaleRelate"] = "ìƒì‚¬";
						    	data["mlssEmpId"] = mlssEmpId;
						    }else{
						    	data["evaleRelate"] = "ë™ë£Œ";
						    	data["mlssEmpId"] = mlssEmpId;
						    }
						  }
						});					
				}
				datas = datas.filter(data => data.score != null);
				if(datas.length != 9) {
					alert("í‰ê°€ë¥¼ ëª¨ë‘ ì‘ì„±í•œë’¤ ì œì¶œí•˜ì„¸ìš”");
					return
				}
				master["mlssEmpId"] = [[${mlssEmpId}]];
				master["mlssId"] = [[${mlssId}]];
				master["empId"] = [[${empId}]];
				
				payLoad["master"] = master;
				payLoad["datas"] = datas;
				console.log(payLoad);
				
				  $.ajax({
				    url: "/mlssUserRegist",                // ìš”ì²­ URL
				    type: "post",                     // GET ë°©ì‹ (fetch ì½”ë“œì™€ ë™ì¼)
				    contentType: "application/json",
				    data: JSON.stringify(payLoad),     // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ìë™ ë³€í™˜			        
				})
				.done((result) => {
				    alert("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");			    
				})
				.fail((error) => {
				    console.error(error);
				    alert("ë°ì´í„° ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
				});  
				
			});
			
			const stList = [[${stList}]];	
			let evalUpr = [[${evaleRelateUpr}]];
			let evalLwr = [[${evaleRelateLwr}]];			
			for(let v of stList) {			
				if(v.evaleRelate == "ë³¸ì¸"){
					$("#selfSt").val(v.mlssEmpIdCount*3+"/ 3");				
				}else if(v.evaleRelate == "ìƒì‚¬"){
					let old = evalUpr.length;					
					$("#suprrSt").val(v.mlssEmpIdCount+" / "+old)
				}else{
					let old = evalLwr.length;
					$("#crkSt").val(v.mlssEmpIdCount+" / "+old)
				}
			}
			
			
			const iemList = [[${iemList}]];
			console.log(iemList);
			const gridData = [];

			// ì§ë¬´ ì—­ëŸ‰ ë°ì´í„°
		    const jobData = iemList['ì§ë¬´ ì—­ëŸ‰'].map(vo => ({
		    	mlssIemId: vo.mlssIemId,
		        ability: vo.ability,
		        mlssIem: vo.mlssIem
		    }));

		    // í˜‘ì—… ì—­ëŸ‰ ë°ì´í„°
		    const coopData = iemList['í˜‘ì—… ì—­ëŸ‰'].map(vo => ({
		    	mlssIemId: vo.mlssIemId,
		        ability: vo.ability,
		        mlssIem: vo.mlssIem
		    }));

		    // ìê¸°ê´€ë¦¬ ì—­ëŸ‰ ë°ì´í„°
		    const selfData = iemList['ìê¸°ê´€ë¦¬ ì—­ëŸ‰'].map(vo => ({
		    	mlssIemId: vo.mlssIemId,
		        ability: vo.ability,
		        mlssIem: vo.mlssIem
		    }));

			
			const grid = new tui.Grid(
					{
						el : document.getElementById('toastGrid'),
						data : jobData,						
						scrollX : false,
						scrollY : false,
						minBodyHeight : 0,
						autoWidth : true,
						columns : gridColums
					});

			// Grid ìƒì„±
			const grid2 = new tui.Grid(
					{
						el : document.getElementById('toastGrid2'),
						data : coopData,						
						scrollX : false,
						scrollY : false,
						minBodyHeight : 0,
						autoWidth : true,
						columns : gridColums
					});

			

			// Grid ìƒì„±
			const grid3 = new tui.Grid(
					{
						el : document.getElementById('toastGrid3'),
						data : selfData,						
						scrollX : false,
						scrollY : false,
						minBodyHeight : 0,
						autoWidth : true,
						columns : gridColums
					});
			//ê¸°ì¡´ì— í‰ê°€í–ˆë‹¤ë©´ ë‚´êº¼ëŠ” í˜ì´ì§€ ë¡œë“œì‹œ ì¶œë ¥ë˜ê²Œ í•˜ëŠ” ì½”ë“œ
			let myWrterList = [[${userWrterList}]]			
			getdbData(myWrterList);
			function getdbData(val) {				
				if(val.length == 9){						
					$("#mlssUserRegist").addClass("stIsShow");
					}else{$("#mlssUserRegist").removeClass("stIsShow")}
				for(let myWrter of val) {					
					$(`input[name="${myWrter.mlssIemId}"]`).each(function(el) {
						if($(this).val() == myWrter.score) {
							$(this).prop("checked", true);
						}
					});				
				};
				console.log(isRegist);
			}
			
			
			
			
			let radarChart;   // ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸í•˜ì—¬ ì–´ë””ì„œë“  ì ‘ê·¼ ê°€ëŠ¥
			let pieChart;   // ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸í•˜ì—¬ ì–´ë””ì„œë“  ì ‘ê·¼ ê°€ëŠ¥
			let columnChart;   // ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸í•˜ì—¬ ì–´ë””ì„œë“  ì ‘ê·¼ ê°€ëŠ¥
			let resultGrid;   // ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸í•˜ì—¬ ì–´ë””ì„œë“  ì ‘ê·¼ ê°€ëŠ¥
			    // 3ëŒ€ ì—­ëŸ‰ ê·¸ë£¹ ì •ì˜
			    const groupMap = {
			        "ì§ë¬´ ì—­ëŸ‰": ["ì—…ë¬´ ì´í•´ë„", "ì „ë¬¸ì„±", "ë¬¸ì œ í•´ê²° ëŠ¥ë ¥"],
			        "í˜‘ì—… ì—­ëŸ‰": ["ì˜ì‚¬ì†Œí†µ ëŠ¥ë ¥", "í˜‘ë ¥ íƒœë„", "ë¬¸ì œí•´ê²° ë° ê¸°ì—¬ë„"],
			        "ìê¸°ê´€ë¦¬ ì—­ëŸ‰": ["ì‹œê°„ ë° ì—…ë¬´ê´€ë¦¬", "ìê¸°ê°œë°œ ë° í•™ìŠµíƒœë„", "ì±…ì„ê° ë° ê·œìœ¨ ì¤€ìˆ˜"]
			    };
			//Raderì°¨íŠ¸ì— ì“°ì´ëŠ” í•¨ìˆ˜
			function makeRadarSeries(resultFinalData) {


			    // ë³¸ì¸ / ìƒì‚¬ / ë™ë£Œ ë³„ ê·¸ë£¹ ê°’ ì €ì¥ìš©
			    const result = {
			        "ë³¸ì¸":     { "ì§ë¬´ ì—­ëŸ‰": [], "í˜‘ì—… ì—­ëŸ‰": [], "ìê¸°ê´€ë¦¬ ì—­ëŸ‰": [] },
			        "ìƒì‚¬":     { "ì§ë¬´ ì—­ëŸ‰": [], "í˜‘ì—… ì—­ëŸ‰": [], "ìê¸°ê´€ë¦¬ ì—­ëŸ‰": [] },
			        "ë™ë£Œ":     { "ì§ë¬´ ì—­ëŸ‰": [], "í˜‘ì—… ì—­ëŸ‰": [], "ìê¸°ê´€ë¦¬ ì—­ëŸ‰": [] }
			    };

			    // í•­ëª©ì„ ê·¸ë£¹ì— ë§¤í•‘
			    for (const row of resultFinalData) {
			        const { mlssIem, evaleRelate, score } = row;

			        for (const groupName in groupMap) {
			            if (groupMap[groupName].includes(mlssIem)) {
			                result[evaleRelate][groupName].push(score ?? 0);
			            }
			        }
			    }

			    // ê·¸ë£¹ í‰ê·  ê³„ì‚° í•¨ìˆ˜
			    function avg(arr) {
			        if (arr.length === 0) return 0;
			        return arr.reduce((a, b) => a + b, 0) / arr.length;
			    }

			    // radarChart ë°ì´í„° êµ¬ì¡° ì œì‘
			    return [
			        {
			            name: "ë³¸ì¸",
			            data: [
			                avg(result["ë³¸ì¸"]["ì§ë¬´ ì—­ëŸ‰"]),
			                avg(result["ë³¸ì¸"]["í˜‘ì—… ì—­ëŸ‰"]),
			                avg(result["ë³¸ì¸"]["ìê¸°ê´€ë¦¬ ì—­ëŸ‰"])
			            ]
			        },
			        {
			            name: "ìƒì‚¬",
			            data: [
			                avg(result["ë™ë£Œ"]["ì§ë¬´ ì—­ëŸ‰"]),
			                avg(result["ë™ë£Œ"]["í˜‘ì—… ì—­ëŸ‰"]),
			                avg(result["ë™ë£Œ"]["ìê¸°ê´€ë¦¬ ì—­ëŸ‰"])
			            ]
			        },
			        {
			            name: "ë™ë£Œ",
			            data: [
			                avg(result["ìƒì‚¬"]["ì§ë¬´ ì—­ëŸ‰"]),
			                avg(result["ìƒì‚¬"]["í˜‘ì—… ì—­ëŸ‰"]),
			                avg(result["ìƒì‚¬"]["ìê¸°ê´€ë¦¬ ì—­ëŸ‰"])
			            ]
			        }
			    ];
			}
			
			//Pieì°¨íŠ¸ì— ì“°ì´ëŠ” í•¨ìˆ˜
			function makePieSeries(resultFinalData) {    

    // ê²°ê³¼ ì €ì¥ ê°ì²´
    const result = {
        "ì§ë¬´ ì—­ëŸ‰": [],
        "í˜‘ì—… ì—­ëŸ‰": [],
        "ìê¸°ê´€ë¦¬ ì—­ëŸ‰": []
    };

    // ë³¸ì¸ í‰ê°€ë§Œ ì¶”ì¶œ
    const myList = resultFinalData.filter(row => row.evaleRelate === "ë³¸ì¸");

    // í•­ëª©ì„ ê·¸ë£¹ì— ë§¤í•‘í•˜ì—¬ ì ìˆ˜ push
    for (const row of myList) {
        const { mlssIem, score } = row;

        for (const groupName in groupMap) {
            if (groupMap[groupName].includes(mlssIem)) {
                result[groupName].push(score ?? 0);
            }
        }
    }

    // í‰ê·  ê³„ì‚° í•¨ìˆ˜
    function avg(arr) {
        if (arr.length === 0) return 0;
        return arr.reduce((a, b) => a + b, 0) / arr.length;
    }

    // pieChart series í˜•íƒœë¡œ ë³€í™˜
    return [
        { name: 'ì§ë¬´ ì—­ëŸ‰', data: avg(result["ì§ë¬´ ì—­ëŸ‰"]) },
        { name: 'í˜‘ì—… ì—­ëŸ‰', data: avg(result["í˜‘ì—… ì—­ëŸ‰"]) },
        { name: 'ìê¸°ê´€ë¦¬ ì—­ëŸ‰', data: avg(result["ìê¸°ê´€ë¦¬ ì—­ëŸ‰"]) }
    ];
}

			
			//ì´í•© ê·¸ë¦¬ë“œ ì¶œë ¥í•¨ìˆ˜
			function makeGridData(resultFinalData) {
    const relateTypes = ["ë³¸ì¸", "ìƒì‚¬", "ë™ë£Œ"];

    // ê²°ê³¼ ì €ì¥ìš© ê°ì²´
    const result = {
        "ë³¸ì¸": { "ì§ë¬´ ì—­ëŸ‰": [], "í˜‘ì—… ì—­ëŸ‰": [], "ìê¸°ê´€ë¦¬ ì—­ëŸ‰": [] },
        "ìƒì‚¬": { "ì§ë¬´ ì—­ëŸ‰": [], "í˜‘ì—… ì—­ëŸ‰": [], "ìê¸°ê´€ë¦¬ ì—­ëŸ‰": [] },
        "ë™ë£Œ": { "ì§ë¬´ ì—­ëŸ‰": [], "í˜‘ì—… ì—­ëŸ‰": [], "ìê¸°ê´€ë¦¬ ì—­ëŸ‰": [] }
    };

    // rowë“¤ì„ ê·¸ë£¹/í‰ê°€ìë³„ë¡œ ë¶„ë°°
    for (const row of resultFinalData) {
        const { evaleRelate, mlssIem, score } = row;

        if (!relateTypes.includes(evaleRelate)) continue;

        for (const groupName in groupMap) {
            if (groupMap[groupName].includes(mlssIem)) {
                result[evaleRelate][groupName].push(score ?? 0);
            }
        }
    }

    // í‰ê·  ê³„ì‚° í•¨ìˆ˜
    function avg(arr) {
        if (arr.length === 0) return 0;
        return arr.reduce((a, b) => a + b, 0) / arr.length;
    }

    // ê° í‰ê°€ìë³„ ì´ í‰ê·  (3ê°œ ì—­ëŸ‰ í‰ê· ì„ ëª¨ë‘ í•©ì¹¨)
    const totalAvg = {};

    relateTypes.forEach(type => {
        const job = avg(result[type]["ì§ë¬´ ì—­ëŸ‰"]);
        const coop = avg(result[type]["í˜‘ì—… ì—­ëŸ‰"]);
        const self = avg(result[type]["ìê¸°ê´€ë¦¬ ì—­ëŸ‰"]);

        totalAvg[type] = Number(((job + coop + self)/3).toFixed(2));
    });

    // ì¡°ì§ í‰ê·  (= ìƒì‚¬ + ë™ë£Œ í‰ê· )
    const groupAvgScore = Number(((totalAvg["ìƒì‚¬"] + totalAvg["ë™ë£Œ"]) / 2).toFixed(2));

    // ë³¸ì¸ì˜ ì¡°ì§ ëŒ€ë¹„ ì ìˆ˜ ì°¨ì´
    const groupReadinessScore = Number((totalAvg["ë³¸ì¸"] - groupAvgScore).toFixed(2));

    // Gridì— ë„£ì„ ìµœì¢… ë°ì´í„°
    return [{
        id: 1,
        fin: "ì´ í•©ê³„ í‰ê· ì ìˆ˜",
        self: totalAvg["ë³¸ì¸"],
        suprr: totalAvg["ìƒì‚¬"],
        crk: totalAvg["ë™ë£Œ"],
        groupAvgScore: groupAvgScore,
        groupReadinessScore: groupReadinessScore
    }];
}



			function showRadarChart() {
				const radarEl = document.getElementById('radar');
			    const pieEl = document.getElementById('pie');
			    const columnEl = document.getElementById('column');
			    const gridEl = document.getElementById('toastGrid4');
				
			    if (radarChart) radarChart.destroy(); 
			    
			    if (pieChart) pieChart.destroy(); 
			    
			    if (resultGrid) resultGrid.destroy(); 
			    
			    if (columnChart) columnChart.destroy();
			    //makeRadarData(iemList, myWrterList, "ë³¸ì¸")
			    
			    const radarSeries = makeRadarSeries(resultFinalData);
			    
			    radarChart = toastui.Chart.radarChart({
			        el: radarEl,
			        data: {
			            categories: ['ì§ë¬´ ì—­ëŸ‰', 'í˜‘ì—… ì—­ëŸ‰', 'ìê¸°ê´€ë¦¬ ì—­ëŸ‰'],
			            series: radarSeries
			        },
			        options: {
			            series: { showArea: true },
			            chart: {
				            width: 600,   // ì›í•˜ëŠ” ë„ˆë¹„
				            height: 600   // ì›í•˜ëŠ” ë†’ì´
				          }
			        },		        
			    });	
			    
			    const pieSeries = makePieSeries(resultFinalData);
			    
			    pieChart = toastui.Chart.pieChart({
			        el: pieEl,
			        data: {
			            series: pieSeries
			        },
			        options: {
			            chart: {
			                title: 'ë³¸ì¸ ì—­ëŸ‰ ë¹„ìœ¨'
			            }
			        }
			    });
			    
			 // ì›í•˜ëŠ” category ìˆœì„œ
			    const categories = [
			      'ì—…ë¬´ ì´í•´ë„', 'ì „ë¬¸ì„±', 'ë¬¸ì œ í•´ê²° ëŠ¥ë ¥',
			      'ì˜ì‚¬ì†Œí†µ ëŠ¥ë ¥', 'í˜‘ë ¥ íƒœë„', 'ë¬¸ì œí•´ê²° ë° ê¸°ì—¬ë„',
			      'ì‹œê°„ ë° ì—…ë¬´ê´€ë¦¬', 'ìê¸°ê°œë°œ ë° í•™ìŠµíƒœë„', 'ì±…ì„ê° ë° ê·œìœ¨ ì¤€ìˆ˜'
			    ];
			    
			 // ì´ˆê¸°ê°’
			    const selfData = Array(categories.length).fill(0);
			    const suprrData = Array(categories.length).fill(0);
			    const crkData = Array(categories.length).fill(0);

			    // ë°ì´í„° ë§¤í•‘
			    resultFinalData.forEach(item => {
			      const idx = categories.indexOf(item.mlssIem);
			      if (idx === -1) return;

			      if (item.evaleRelate === 'ë³¸ì¸') {
			        selfData[idx] = item.score ?? 0;
			      } else if (item.evaleRelate === 'ìƒì‚¬') {
			        suprrData[idx] = item.score ?? 0;
			      } else if (item.evaleRelate === 'ë™ë£Œ') {
			        crkData[idx] = item.score ?? 0;
			      }
			    });
			    
			    columnChart = toastui.Chart.columnChart({
			        el: columnEl,
			        data: {
			            categories: categories,
			            series: [
			              {
			                name: 'ë³¸ì¸',
			                data: selfData
			              },
			              {
			                name: 'ìƒì‚¬',
			                data: crkData
			              },
			              {
			                name: 'ë™ë£Œ',
			                data: suprrData
			              }
			            ]
			          },
			        options: {
			            chart: { title: 'ì—­ëŸ‰ë³„ ì„¸ë¶€ í•­ëª© ì ìˆ˜' },
			            yAxis: { title: 'ì ìˆ˜' },
			            xAxis: { title: 'ì—­ëŸ‰ ê·¸ë£¹' },
			            width: 900,
			            height: 400
			        }			        
			    });
			    
			    const gridData = makeGridData(resultFinalData);

				// Grid ìƒì„±
				resultGrid = new tui.Grid(
						{
							el : gridEl,
							data : gridData,
							scrollX : false,
							scrollY : false,
							minBodyHeight : 0,
							autoWidth : true,
							columns : [{
										header : 'ë‹¤ë©´í‰ê°€ ì¢…í•©ì ìˆ˜',
										name : 'fin',
										sortable : true
										},
										{
											header : 'ë³¸ì¸',
											name : 'self',
											align : 'left',												
										},{
											header : 'ìƒì‚¬',
											name : 'crk',
											align : 'left',												
										},{
											header : 'ë™ë£Œ',
											name : 'suprr',
											align : 'left',												
										},{
											header : 'ì¡°ì§í‰ê· ',
											name : 'groupAvgScore',
											align : 'left',												
										},{
											header : 'ì¡°ì§ëŒ€ë¹„',
											name : 'groupReadinessScore',
											align : 'left',												
										},]
						});


			}

		</script>

	


</body>

</html>