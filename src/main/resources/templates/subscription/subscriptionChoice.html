<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>Subscription Choice</title>
<style>
/* 카드 내 구독 플랜 선택 영역 정렬 */
.subscription-choice-card .plan-column {
	text-align: center;
}

.subscription-choice-card .plan-header {
	font-size: 1.25rem;
	font-weight: 600;
	margin-bottom: 0.5rem;
}

.subscription-choice-card .plan-body {
	font-size: 0.95rem;
	color: #555;
	min-height: 80px;
}

.subscription-choice-card .plan-wrapper {
	border: 1px solid #e0e0e0;
	border-radius: 0.5rem;
	padding: 1.5rem 1rem;
	transition: box-shadow 0.2s ease, transform 0.2s ease;
	cursor: pointer;
}

.subscription-choice-card .plan-wrapper:hover {
	box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.08);
	transform: translateY(-2px);
}

.subscription-choice-card .plan-tag {
	font-size: 0.75rem;
	font-weight: 600;
	color: #6c757d;
	text-transform: uppercase;
	letter-spacing: 0.05em;
	margin-bottom: 0.25rem;
}

.subscription-choice-card .plan-price {
	font-size: 1.1rem;
	font-weight: 600;
	margin-top: 0.75rem;
}

.subscription-choice-card .plan-cta {
	margin-top: 1rem;
}

.subscription-choice-card {
	min-height: 480px; /* 최소 높이 지정 */
}

/* 요금 주기 토글 버튼 라인 */
.billing-toggle-row {
	margin-bottom: 1.5rem;
}

.billing-toggle-row .btn-group-toggle {
	width: 100%;
}

.billing-toggle-row .btn-group-toggle .btn {
	flex: 1 1 50%;
}

/* 요금 토글 버튼 테두리 색을 플랜 테두리(#e0e0e0)와 동일하게 */
.billing-toggle-row .btn-outline-primary {
	border-color: #e0e0e0;
	color: #0d6efd; /* 기본 텍스트 색상 유지(부트스트랩 primary 톤) */
}

/* active/hover 상태에서 동일한 스타일 유지 */
.billing-toggle-row .btn-outline-primary.billing-active,
	.billing-toggle-row .btn-outline-primary:hover, .billing-toggle-row .btn-outline-primary:focus
	{
	border-color: #e0e0e0;
	background-color: rgba(13, 110, 253, 0.06);
	color: #0d6efd;
	box-shadow: none;
}

/* 플랜 선택 버튼 active 상태를 hover 상태와 동일하게 보이도록 */
.plan-cta .btn.btn-outline-primary.active, .plan-cta .btn.btn-outline-primary:hover
	{
	color: #fff;
	background-color: #0d6efd;
	border-color: #0d6efd;
}

.plan-cta .btn.btn-outline-dark.active, .plan-cta .btn.btn-outline-dark:hover
	{
	color: #fff;
	background-color: #343a40;
	border-color: #343a40;
}
</style>
</head>
<body layout:fragment="content">

	<div class="row">
		<div class="col-md-12">
			<div class="card mb-3 subscription-choice-card">
				<div class="card-header">
					<div class="card-header-left">
						<h5 class="card-title">구독 플랜</h5>
					</div>
					<div class="card-header-right">
						<a th:href="@{/}">
							<button class="btn btn-outline-dark" type="button">홈으로</button>
						</a>
						<form th:action="@{/Payment}" method="post" style="display:inline-block;">
							<input type="hidden" name="planName" id="selectedPlanInput" />
							<input type="hidden" name="billingCycle" id="selectedBillingInput" />
							<button class="btn btn-outline-dark" type="submit" id="nextButton" disabled>다음</button>
						</form>

					</div>
				</div>
				<div class="card-body">

					<!-- 월간 / 연간 요금 토글 영역 -->
					<div class="billing-toggle-row">
						<div class="btn-group btn-group-toggle">
							<label
								class="btn btn-outline-primary w-50 billing-toggle-btn billing-active"
								data-billing="MONTHLY"> <input type="radio"
								name="billingCycle" id="billingMonthly" autocomplete="off"
								checked> 월간 요금
							</label> <label class="btn btn-outline-primary w-50 billing-toggle-btn"
								data-billing="YEARLY"> <input type="radio"
								name="billingCycle" id="billingYearly" autocomplete="off">
								연간 요금
							</label>
						</div>
					</div>

					<div class="row">
						<!-- Basic Plan -->
						<div class="col-md-4 plan-column mb-3 mb-md-0">
							<div class="plan-wrapper h-100">
								<div class="plan-tag">BASIC</div>
								<div class="plan-header">베이식 플랜</div>
								<div class="plan-body">
									<span class="plan-desc"> 작은 팀이나 테스트용으로 적합한 기본 기능 제공. <br />
										월간 사용량이 많지 않은 경우에 추천합니다.
									</span>
									<div class="mt-2">
										<!-- BASIC / 월 -->
										<div class="plan-billing-block" data-plan="BASIC" data-billing="MONTHLY">
											<div th:each="p : ${planList}"
												th:if="${p.planNm == 'BASIC' and (p.sttlPerd == 'b1' or p.sttlPerd == '\uc6d4')}">
												<div>
													월 API 허용 횟수 : <span
														th:text="${#numbers.formatInteger(p.apiIssuCnt, 0, 'COMMA')}"></span>
												</div>
												<div>
													계정 생성 제한 수 : <span
														th:text="${#numbers.formatInteger(p.acctIssuCnt, 0, 'COMMA')}"></span>
												</div>
											</div>
											<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'BASIC' and (sttlPerd == 'b1' or sttlPerd == '\uc6d4')])}">
												<div>월 API 허용 횟수 : <span>0</span></div>
												<div>계정 생성 제한 수 : <span>0</span></div>
											</div>
										</div>

										<!-- BASIC / 연 -->
										<div class="plan-billing-block" data-plan="BASIC" data-billing="YEARLY" style="display: none">
											<div th:each="p : ${planList}"
												th:if="${p.planNm == 'BASIC' and (p.sttlPerd == 'b2' or p.sttlPerd == '\uc5f0')}">
												<div>
													월 API 허용 횟수 : <span
														th:text="${#numbers.formatInteger(p.apiIssuCnt, 0, 'COMMA')}"></span>
												</div>
												<div>
													계정 생성 제한 수 : <span
														th:text="${#numbers.formatInteger(p.acctIssuCnt, 0, 'COMMA')}"></span>
												</div>
											</div>
											<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'BASIC' and (sttlPerd == 'b2' or sttlPerd == '\uc5f0')])}">
												<div>월 API 허용 횟수 : <span>0</span></div>
												<div>계정 생성 제한 수 : <span>0</span></div>
											</div>
										</div>
									</div>
								</div>
								<div class="plan-price">
									<!-- BASIC / 월 -->
									<div class="plan-billing-block" data-plan="BASIC" data-billing="MONTHLY">
										<div th:each="p : ${planList}"
											th:if="${p.planNm == 'BASIC' and (p.sttlPerd == 'b1' or p.sttlPerd == '\uc6d4')}">
												<span th:text="${#numbers.formatInteger(p.amt, 0, 'COMMA')}"></span> ₩&nbsp;/ 월
											</div>
										<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'BASIC' and (sttlPerd == 'b1' or sttlPerd == '\uc6d4')])}">
											<span>0</span>&nbsp;/ 월
										</div>
									</div>

									<!-- BASIC / 연 -->
									<div class="plan-billing-block" data-plan="BASIC" data-billing="YEARLY" style="display: none">
										<div th:each="p : ${planList}"
											th:if="${p.planNm == 'BASIC' and (p.sttlPerd == 'b2' or p.sttlPerd == '\uc5f0')}">
												<span th:text="${#numbers.formatInteger(p.amt, 0, 'COMMA')}"></span> ₩&nbsp;/ 연
											</div>
										<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'BASIC' and (sttlPerd == 'b2' or sttlPerd == '\uc5f0')])}">
											<span>0</span>&nbsp;/ 연
										</div>
									</div>
								</div>
								<div class="plan-cta">
									<button type="button" class="btn btn-outline-dark btn-sm plan-select-btn" data-plan="BASIC">선택</button>
								</div>
							</div>
						</div>

						<!-- Standard Plan -->
						<div class="col-md-4 plan-column mb-3 mb-md-0">
							<div class="plan-wrapper h-100">
								<div class="plan-tag">STANDARD</div>
								<div class="plan-header">스탠다드 플랜</div>
								<div class="plan-body">
									일반적인 비즈니스 운영에 필요한 기능을 균형 있게 제공. 추가 계정과 API 호출 한도가 포함된 플랜입니다.
									<div class="mt-2">
										<!-- STANDARD / 월 -->
										<div class="plan-billing-block" data-plan="STANDARD" data-billing="MONTHLY">
											<div th:each="p : ${planList}"
												th:if="${p.planNm == 'STANDARD' and (p.sttlPerd == 'b1' or p.sttlPerd == '\uc6d4')}">
												<div>월 API 허용 횟수 : <span th:text="${#numbers.formatInteger(p.apiIssuCnt, 0, 'COMMA')}"></span></div>
												<div>계정 생성 제한 수 : <span th:text="${#numbers.formatInteger(p.acctIssuCnt, 0, 'COMMA')}"></span></div>
											</div>
											<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'STANDARD' and (sttlPerd == 'b1' or sttlPerd == '\uc6d4')])}">
												<div>월 API 허용 횟수 : <span>0</span></div>
												<div>계정 생성 제한 수 : <span>0</span></div>
											</div>
										</div>

										<!-- STANDARD / 연 -->
										<div class="plan-billing-block" data-plan="STANDARD" data-billing="YEARLY" style="display: none">
											<div th:each="p : ${planList}"
												th:if="${p.planNm == 'STANDARD' and (p.sttlPerd == 'b2' or p.sttlPerd == '\uc5f0')}">
												<div>월 API 허용 횟수 : <span th:text="${#numbers.formatInteger(p.apiIssuCnt, 0, 'COMMA')}"></span></div>
												<div>계정 생성 제한 수 : <span th:text="${#numbers.formatInteger(p.acctIssuCnt, 0, 'COMMA')}"></span></div>
											</div>
											<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'STANDARD' and (sttlPerd == 'b2' or sttlPerd == '\uc5f0')])}">
												<div>월 API 허용 횟수 : <span>0</span></div>
												<div>계정 생성 제한 수 : <span>0</span></div>
											</div>
										</div>
									</div>
								</div>
								<div class="plan-price">
									<!-- STANDARD / 월 -->
									<div class="plan-billing-block" data-plan="STANDARD" data-billing="MONTHLY">
										<div th:each="p : ${planList}"
											th:if="${p.planNm == 'STANDARD' and (p.sttlPerd == 'b1' or p.sttlPerd == '\uc6d4')}">
												<span th:text="${#numbers.formatInteger(p.amt, 0, 'COMMA')}"></span> ₩&nbsp;/ 월
											</div>
										<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'STANDARD' and (sttlPerd == 'b1' or sttlPerd == '\uc6d4')])}">
											<span>0</span>&nbsp;/ 월
										</div>
									</div>

									<!-- STANDARD / 연 -->
									<div class="plan-billing-block" data-plan="STANDARD" data-billing="YEARLY" style="display: none">
										<div th:each="p : ${planList}"
											th:if="${p.planNm == 'STANDARD' and (p.sttlPerd == 'b2' or p.sttlPerd == '\uc5f0')}">
												<span th:text="${#numbers.formatInteger(p.amt, 0, 'COMMA')}"></span> ₩&nbsp;/ 연
											</div>
										<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'STANDARD' and (sttlPerd == 'b2' or sttlPerd == '\uc5f0')])}">
											<span>0</span>&nbsp;/ 연
										</div>
									</div>
								</div>
								<div class="plan-cta">
									<button type="button" class="btn btn-outline-dark btn-sm plan-select-btn" data-plan="STANDARD">선택</button>
								</div>
							</div>
						</div>

						<!-- Premium Plan -->
						<div class="col-md-4 plan-column">
							<div class="plan-wrapper h-100">
								<div class="plan-tag">PREMIUM</div>
								<div class="plan-header">프리미엄 플랜</div>
								<div class="plan-body">
									고급 기능과 넉넉한 사용량을 제공하는 상위 플랜. 성장 단계 이상의 기업에 적합한 구성입니다.
									<div class="mt-2">
										<!-- PREMIUM / 월 -->
										<div class="plan-billing-block" data-plan="PREMIUM" data-billing="MONTHLY">
											<div th:each="p : ${planList}"
												th:if="${p.planNm == 'PREMIUM' and (p.sttlPerd == 'b1' or p.sttlPerd == '\uc6d4')}">
												<div>월 API 허용 횟수 : <span th:text="${#numbers.formatInteger(p.apiIssuCnt, 0, 'COMMA')}"></span></div>
												<div>계정 생성 제한 수 : <span th:text="${#numbers.formatInteger(p.acctIssuCnt, 0, 'COMMA')}"></span></div>
											</div>
											<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'PREMIUM' and (sttlPerd == 'b1' or sttlPerd == '\uc6d4')])}">
												<div>월 API 허용 횟수 : <span>0</span></div>
												<div>계정 생성 제한 수 : <span>0</span></div>
											</div>
										</div>

										<!-- PREMIUM / 연 -->
										<div class="plan-billing-block" data-plan="PREMIUM" data-billing="YEARLY" style="display: none">
											<div th:each="p : ${planList}"
												th:if="${p.planNm == 'PREMIUM' and (p.sttlPerd == 'b2' or p.sttlPerd == '\uc5f0')}">
												<div>월 API 허용 횟수 : <span th:text="${#numbers.formatInteger(p.apiIssuCnt, 0, 'COMMA')}"></span></div>
												<div>계정 생성 제한 수 : <span th:text="${#numbers.formatInteger(p.acctIssuCnt, 0, 'COMMA')}"></span></div>
											</div>
											<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'PREMIUM' and (sttlPerd == 'b2' or sttlPerd == '\uc5f0')])}">
												<div>월 API 허용 횟수 : <span>0</span></div>
												<div>계정 생성 제한 수 : <span>0</span></div>
											</div>
										</div>
									</div>
								</div>
								<div class="plan-price">
									<!-- PREMIUM / 월 -->
									<div class="plan-billing-block" data-plan="PREMIUM" data-billing="MONTHLY">
										<div th:each="p : ${planList}"
											th:if="${p.planNm == 'PREMIUM' and (p.sttlPerd == 'b1' or p.sttlPerd == '\uc6d4')}">
												<span th:text="${#numbers.formatInteger(p.amt, 0, 'COMMA')}"></span> ₩&nbsp;/ 월
											</div>
										<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'PREMIUM' and (sttlPerd == 'b1' or sttlPerd == '\uc6d4')])}">
											<span>0</span>&nbsp;/ 월
										</div>
									</div>

									<!-- PREMIUM / 연 -->
									<div class="plan-billing-block" data-plan="PREMIUM" data-billing="YEARLY" style="display: none">
										<div th:each="p : ${planList}"
											th:if="${p.planNm == 'PREMIUM' and (p.sttlPerd == 'b2' or p.sttlPerd == '\uc5f0')}">
												<span th:text="${#numbers.formatInteger(p.amt, 0, 'COMMA')}"></span> ₩&nbsp;/ 연
											</div>
										<div th:if="${#lists.isEmpty(planList) or #lists.isEmpty(planList.?[planNm == 'PREMIUM' and (sttlPerd == 'b2' or sttlPerd == '\uc5f0')])}">
											<span>0</span>&nbsp;/ 연
										</div>
									</div>
								</div>
								<div class="plan-cta">
									<button type="button" class="btn btn-outline-dark btn-sm plan-select-btn" data-plan="PREMIUM">선택</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
	// 플랜 / 요금제 선택 상태를 Payment로 전달하기 위해 hidden input 갱신
	document.addEventListener('DOMContentLoaded', function() {
		const planButtons = document.querySelectorAll('.plan-select-btn');
		const billingButtons = document.querySelectorAll('.billing-toggle-btn');
		const billingBlocks = document.querySelectorAll('.plan-billing-block');
		const selectedPlanInput = document.getElementById('selectedPlanInput');
		const selectedBillingInput = document.getElementById('selectedBillingInput');
		const nextButton = document.getElementById('nextButton');

		let currentPlan = null; // BASIC / STANDARD / PREMIUM
		let currentBilling = 'MONTHLY'; // 기본값

		function updateHiddenFields() {
			if (currentPlan && currentBilling) {
				selectedPlanInput.value = currentPlan;
				selectedBillingInput.value = currentBilling;
				nextButton.disabled = false;
			} else {
				nextButton.disabled = true;
			}
		}

		// 플랜 선택 버튼 클릭 시 active 토글 및 현재 선택값 저장
		planButtons.forEach(btn => {
			btn.addEventListener('click', function() {
				planButtons.forEach(b => b.classList.remove('active'));
				this.classList.add('active');
				currentPlan = this.getAttribute('data-plan');
				updateHiddenFields();
			});
		});

		// 월간/연간 요금 토글 + 블록 전환 + 현재 선택값 저장
		billingButtons.forEach(btn => {
			btn.addEventListener('click', function() {
				billingButtons.forEach(b => b.classList.remove('billing-active'));
				this.classList.add('billing-active');
				const input = this.querySelector('input[type="radio"]');
				if (input) {
					input.checked = true;
				}

				currentBilling = this.getAttribute('data-billing');

				billingBlocks.forEach(block => {
					const blockBilling = block.getAttribute('data-billing');
					if (blockBilling === currentBilling) {
						block.style.display = '';
					} else {
						block.style.display = 'none';
					}
				});

				updateHiddenFields();
			});
		});

		// 초기값: 월간 선택
		updateHiddenFields();
	});
	</script>

</body>
</html>