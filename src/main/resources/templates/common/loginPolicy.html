<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>보안 정책 설정</title>

<style>
.security-wrapper .card-title {
	font-weight: 600;
}

/* 숫자 입력 단위(span) 크기 맞추기 */
.unit-span {
	min-width: 40px;
	text-align: center;
}

/* 이 페이지 안에서만 form-check 정렬 재정의
           → 카드 밖으로 튀어나오지 않고 같은 열에 정렬되도록 */
.security-wrapper .form-check {
	display: inline-flex; /* 라벨 + 인풋 한 줄 */
	align-items: center;
	padding-left: 0;
	margin-bottom: 0.25rem;
}

.security-wrapper .form-check-input {
	position: static;
	float: none;
	/* 글자와 동그라미/체크박스 사이 여백 */
	margin: 0 0 0 .45rem;
}

.security-wrapper .form-check-inline+.form-check-inline {
	margin-left: 0.75rem; /* 같은 라인 내 옵션 간 간격 */
}

/* OTP / CAPTCHA 상세 설정 비활성화 시 시각적 처리용 */
.security-wrapper .section-disabled {
	opacity: .6;
}
</style>
</head>
<body layout:fragment="content">
	<div class="security-wrapper">

		<!-- 전체 카드 -->
		<div class="card">

			<!-- 상단 헤더 : 제목 + 버튼 -->
			<div
				class="card-header mb-3 d-flex justify-content-between align-items-center">
				<div class="card-header-left">
					<h5 class="card-title">보안 정책 설정</h5>
				</div>
				<div class="card-header-right">
					<!-- <button type="button" class="btn btn-dark" id="btnReset">초기화</button> -->
					<div th:replace="~{fragments/buttons :: resetButton('MENU_COMM_002', 'btnReset')}"></div>
					<!-- <button type="button" class="btn btn-outline-dark" id="btnSave">저장</button> -->
					<div th:replace="~{fragments/buttons :: saveButton('MENU_COMM_002', 'btnSave')}"></div>
				</div>
			</div>

			<div class="card-body">
				<div class="row">
					<!-- 왼쪽 : 계정 잠금 / 세션 정책 -->
					<div class="col-md-6">

						<!-- 계정 잠금 정책 카드 -->
						<div class="card border mb-3">

							<!-- 카드 헤더 -->
							<div class="card-header">
								<div class="card-header-left">
									<h5 class="card-title">계정 잠금 정책</h5>
								</div>
								<div class="card-header-right">
									<!-- 필요하면 여기에 카드별 버튼 추가 -->
								</div>
							</div>

							<div class="card-body">
								<!-- 로그인 실패 허용 횟수 (pw_fail_cnt) -->
								<div class="mb-3">
									<label class="form-label" for="pwFailCnt">로그인 실패 허용 횟수</label>
									<div class="input-group">
										<input type="number" class="form-control" id="pwFailCnt"
											name="pwFailCnt" value="5" max="10" min="3"> <span
											class="input-group-text unit-span">회</span>
									</div>
									<div class="form-text">최소 3회, 최대 10회까지 허용 가능합니다.</div>
								</div>

								<!-- 자동 잠금 해제 여부 -->
								<div class="mb-1">
									<span class="form-label d-block mb-1">자동 잠금 해제 여부</span>
									<div class="form-check form-check-inline">
										<label class="form-check-label" for="autoUnlockY">사용</label> <input
											class="form-check-input" type="radio" name="autoUnlockYn"
											id="autoUnlockY" value="Y" checked>
									</div>
									<div class="form-check form-check-inline">
										<label class="form-check-label" for="autoUnlockN">미사용</label>
										<input class="form-check-input" type="radio"
											name="autoUnlockYn" id="autoUnlockN" value="N">
									</div>
									<div class="form-text">미사용 선택 시 잠금 유지 시간은 0으로 저장되어, 관리자만
										수동으로 해제합니다.</div>
								</div>

								<!-- 잠금 유지 시간 (auto_unlock_tm) -->
								<div class="mb-3">
									<label class="form-label" for="autoUnlockTm">잠금 유지 시간</label>
									<div class="input-group">
										<input type="number" class="form-control" id="autoUnlockTm"
											name="autoUnlockTm" value="30" max="120" min="1"> <span
											class="input-group-text unit-span">분</span>
									</div>
									<div class="form-text">자동 해제 사용 시, 해당 시간(1분 ~ 120분) 이후 계정 잠금이
										자동으로 해제됩니다.</div>
								</div>

							</div>
						</div>

						<!-- 세션 정책 카드 -->
						<div class="card border">

							<!-- 카드 헤더 -->
							<div class="card-header">
								<div class="card-header-left">
									<h5 class="card-title">세션 정책</h5>
								</div>
								<div class="card-header-right">
									<!-- 필요하면 여기에도 버튼 추가 가능 -->
								</div>
							</div>

							<div class="card-body">
								<!-- 세션 타임 아웃 (session_timeout_min) -->
								<div class="mb-3">
									<label class="form-label" for="sessionTimeoutMin">세션 타임
										아웃</label>
									<div class="input-group">
										<input type="number" class="form-control"
											id="sessionTimeoutMin" name="sessionTimeoutMin" value="30"
											max="120" min="15"> <span
											class="input-group-text unit-span">분</span>
									</div>
									<div class="form-text">15분 ~ 120분까지 설정 가능합니다.</div>
								</div>

								<!-- 타임 아웃 시 동작 (timeout_action: t1/t2) -->
								<div class="mb-1">
									<span class="form-label d-block mb-1">타임 아웃 시 동작</span>
									<div class="form-check form-check-inline">
										<label class="form-check-label" for="timeoutAutoLogout">자동
											로그 아웃</label> <input class="form-check-input" type="radio"
											name="timeoutAction" id="timeoutAutoLogout" value="t1"
											checked>
									</div>
									<div class="form-check form-check-inline">
										<label class="form-check-label" for="timeoutWarnLogout">경고
											후 로그 아웃</label> <input class="form-check-input" type="radio"
											name="timeoutAction" id="timeoutWarnLogout" value="t2">
									</div>
								</div>
							</div>
						</div>

					</div>

					<!-- 오른쪽 : 비밀번호 / OTP / CAPTCHA 정책 카드 -->
					<div class="col-md-6">
						<div class="card border h-100">

							<!-- 카드 헤더 -->
							<div class="card-header">
								<div class="card-header-left">
									<h5 class="card-title">비밀번호 / 인증 정책</h5>
								</div>
								<div class="card-header-right">
									<!-- 필요 시 버튼 추가 -->
								</div>
							</div>

							<div class="card-body">
								<!-- 비밀번호 길이 (pw_len_min / pw_len_max) -->
								<div class="row mb-3">
									<div class="col-md-6">
										<label class="form-label" for="pwLenMin">비밀번호 최소 길이</label>
										<div class="input-group">
											<input type="number" class="form-control" id="pwLenMin"
												name="pwLenMin" value="8" min="8" max="30"> <span
												class="input-group-text unit-span">자</span>
										</div>
										<div class="form-text">최소 8자</div>
									</div>
									<div class="col-md-6">
										<label class="form-label" for="pwLenMax">비밀번호 최대 길이</label>
										<div class="input-group">
											<input type="number" class="form-control" id="pwLenMax"
												name="pwLenMax" value="20" max="30" min="8"> <span
												class="input-group-text unit-span">자</span>
										</div>
										<div class="form-text">최대 30자</div>
									</div>
								</div>

								<!-- 필수 포함 규칙 (use_upper_yn / use_lower_yn / use_num_yn / use_spcl_yn) -->
								<div class="mb-3">
									<span class="form-label d-block mb-1">비밀번호 필수 포함 규칙</span>

									<div class="form-check">
										<label class="form-check-label" for="ruleUpper">대문자 포함</label>
										<input class="form-check-input" type="checkbox" id="ruleUpper"
											name="useUpperYn" value="Y" checked>
									</div>

									<div class="form-check">
										<label class="form-check-label" for="ruleLower">소문자 포함</label>
										<input class="form-check-input" type="checkbox" id="ruleLower"
											name="useLowerYn" value="Y" checked>
									</div>

									<div class="form-check">
										<label class="form-check-label" for="ruleNumber">숫자 포함</label>
										<input class="form-check-input" type="checkbox"
											id="ruleNumber" name="useNumYn" value="Y" checked>
									</div>

									<div class="form-check">
										<label class="form-check-label" for="ruleSpecial">특수문자
											포함</label> <input class="form-check-input" type="checkbox"
											id="ruleSpecial" name="useSpclYn" value="Y">
									</div>
								</div>

								<!-- 2단계 인증(OTP) 사용 유무 (otp_yn) -->
								<div class="mb-3">
									<span class="form-label d-block mb-1">2단계 인증(OTP) 사용 유무</span>
									<div class="form-check form-check-inline">
										<label class="form-check-label" for="otpY">사용</label> <input
											class="form-check-input" type="radio" name="otpYn" id="otpY"
											value="Y" checked>
									</div>
									<div class="form-check form-check-inline">
										<label class="form-check-label" for="otpN">미사용</label> <input
											class="form-check-input" type="radio" name="otpYn" id="otpN"
											value="N">
									</div>
								</div>

								<!-- OTP 상세 설정 (otp_valid_min, otp_fail_cnt) -->
								<div class="row mb-3 otp-detail-row">
									<div class="col-md-6">
										<label class="form-label" for="otpValidMin">OTP 유효 시간</label>
										<div class="input-group">
											<input type="number" class="form-control" id="otpValidMin"
												name="otpValidMin" min="1" max="30" value="5"> <span
												class="input-group-text unit-span">분</span>
										</div>
										<div class="form-text">발급된 OTP 코드의 유효 시간(1 ~ 30분)입니다.</div>
									</div>
									<div class="col-md-6">
										<label class="form-label" for="otpFailCnt">OTP 최대 실패
											횟수</label>
										<div class="input-group">
											<input type="number" class="form-control" id="otpFailCnt"
												name="otpFailCnt" min="1" max="5" value="3"> <span
												class="input-group-text unit-span">회</span>
										</div>
										<div class="form-text">(1 ~ 5회)초과 시 로그인을 다시 시도해야 합니다.</div>
									</div>
								</div>

								<!-- CAPTCHA 사용 유무 (captcha_yn) -->
								<div class="mb-3">
									<span class="form-label d-block mb-1">CAPTCHA 사용 유무</span>
									<div class="form-check form-check-inline">
										<label class="form-check-label" for="captchaY">사용</label> <input
											class="form-check-input" type="radio" name="captchaYn"
											id="captchaY" value="Y" checked>
									</div>
									<div class="form-check form-check-inline">
										<label class="form-check-label" for="captchaN">미사용</label> <input
											class="form-check-input" type="radio" name="captchaYn"
											id="captchaN" value="N">
									</div>
								</div>

								<!-- CAPTCHA 상세 설정 (captcha_fail_cnt) -->
								<div class="mb-2 captcha-detail-row">
									<label class="form-label" for="captchaFailCnt">CAPTCHA
										요구 실패 횟수</label>
									<div class="input-group">
										<input type="number" class="form-control" id="captchaFailCnt"
											name="captchaFailCnt" min="1" max="5" value="3"> <span
											class="input-group-text unit-span">회</span>
									</div>
									<div class="form-text">동일 계정이 지정한 횟수(1 ~ 5회) 이상
										로그인에 실패하면 CAPTCHA를 요구합니다.</div>
								</div>

							</div>
						</div>
					</div>

				</div>
				<!-- /row -->
			</div>
			<!-- /card-body -->
		</div>
		<!-- /card -->

	</div>
	<!-- /security-wrapper -->

<script>
(function () {

  const CODE_Y = 'e1';
  const CODE_N = 'e2';

  // 화면에서 사용할 기본 정책 값
  const DEFAULT_POLICY = {
    pwFailCnt: 5,
    autoUnlockTm: 30,
    pwLenMin: 8,
    pwLenMax: 20,
    useUpperYn: CODE_Y,
    useLowerYn: CODE_Y,
    useNumYn:   CODE_Y,
    useSpclYn:  CODE_Y,
    otpYn:      CODE_N,
    otpValidMin: 5,
    otpFailCnt:  5,
    captchaYn:    CODE_N,
    captchaFailCnt: 3,
    sessionTimeoutMin: 30,
    timeoutAction: 't2'   // t1=자동 로그아웃, t2=경고 후 로그아웃
  };

  // ==========================
  // 0. 숫자 인풋 범위/키 제한 공통 함수
  // ==========================
  function setupNumberInputGuard(id) {
    const el = document.getElementById(id);
    if (!el) return;

    const minAttr = el.getAttribute('min');
    const maxAttr = el.getAttribute('max');
    const min = minAttr !== null ? parseInt(minAttr, 10) : null;
    const max = maxAttr !== null ? parseInt(maxAttr, 10) : null;

    // e, E, +, -, . 같은 이상한 입력 막기 (정수만 허용)
    el.addEventListener('keydown', function (e) {
      const badKeys = ['e', 'E', '+', '-', '.'];
      if (badKeys.includes(e.key)) {
        e.preventDefault();
      }
    });

    // blur/change 시 실제 값 범위 강제
    function clamp() {
      let v = el.value.trim();
      if (v === '') return; // 빈값은 그대로 두고, 저장 시 validate에서 처리

      let num = Number(v);
      if (isNaN(num)) {
        el.value = '';
        return;
      }

      if (min !== null && num < min) {
        num = min;
      }
      if (max !== null && num > max) {
        num = max;
      }
      el.value = num;
    }

    el.addEventListener('blur', clamp);
    el.addEventListener('change', clamp);
  }

  // ==========================
  // 1. 토글 함수들
  // ==========================
  function toggleAutoUnlock() {
    const autoUnlockInput = document.getElementById('autoUnlockTm');
    if (!autoUnlockInput) return;

    const useAuto = document.querySelector('input[name="autoUnlockYn"]:checked')?.value === 'Y';
    autoUnlockInput.disabled = !useAuto;

    if (!useAuto) {
      autoUnlockInput.value = 0;
    } else if (autoUnlockInput.value === '0' || autoUnlockInput.value === '') {
      autoUnlockInput.value = DEFAULT_POLICY.autoUnlockTm;
    }
  }

  function toggleOtpDetail() {
    const otpDetailRow = document.querySelector('.otp-detail-row');
    if (!otpDetailRow) return;

    const useOtp = document.querySelector('input[name="otpYn"]:checked')?.id === 'otpY';
    otpDetailRow.querySelectorAll('input').forEach(function (el) {
      el.disabled = !useOtp;
    });
    otpDetailRow.classList.toggle('section-disabled', !useOtp);
  }

  function toggleCaptchaDetail() {
    const captchaDetailRow = document.querySelector('.captcha-detail-row');
    if (!captchaDetailRow) return;

    const useCaptcha = document.querySelector('input[name="captchaYn"]:checked')?.id === 'captchaY';
    captchaDetailRow.querySelectorAll('input').forEach(function (el) {
      el.disabled = !useCaptcha;
    });
    captchaDetailRow.classList.toggle('section-disabled', !useCaptcha);
  }

  // ==========================
  // 2. policy → 화면 반영
  // ==========================
  function applyPolicyToForm(policy) {
    const p = Object.assign({}, DEFAULT_POLICY, policy || {});

    // 계정 잠금
    document.getElementById('pwFailCnt').value    = p.pwFailCnt;
    document.getElementById('autoUnlockTm').value = p.autoUnlockTm;

    const autoUse = (p.autoUnlockTm ?? 0) > 0;
    document.getElementById('autoUnlockY').checked = autoUse;
    document.getElementById('autoUnlockN').checked = !autoUse;

    // 세션
    document.getElementById('sessionTimeoutMin').value = p.sessionTimeoutMin;
    if (p.timeoutAction === 't1') {
      document.getElementById('timeoutAutoLogout').checked = true;
    } else {
      document.getElementById('timeoutWarnLogout').checked = true;
    }

    // 비밀번호 길이
    document.getElementById('pwLenMin').value = p.pwLenMin;
    document.getElementById('pwLenMax').value = p.pwLenMax;

    // 비밀번호 규칙
    document.getElementById('ruleUpper').checked   = p.useUpperYn === CODE_Y;
    document.getElementById('ruleLower').checked   = p.useLowerYn === CODE_Y;
    document.getElementById('ruleNumber').checked  = p.useNumYn   === CODE_Y;
    document.getElementById('ruleSpecial').checked = p.useSpclYn  === CODE_Y;

    // OTP
    if (p.otpYn === CODE_Y) {
      document.getElementById('otpY').checked = true;
    } else {
      document.getElementById('otpN').checked = true;
    }
    document.getElementById('otpValidMin').value = p.otpValidMin;
    document.getElementById('otpFailCnt').value  = p.otpFailCnt;

    // CAPTCHA
    if (p.captchaYn === CODE_Y) {
      document.getElementById('captchaY').checked = true;
    } else {
      document.getElementById('captchaN').checked = true;
    }
    document.getElementById('captchaFailCnt').value = p.captchaFailCnt;

    // 토글들 다시 반영
    toggleAutoUnlock();
    toggleOtpDetail();
    toggleCaptchaDetail();
  }

  // ==========================
  // 3. 서버에서 정책 조회 (GET)
  // ==========================
  function loadSecPolicy() {
    fetch('/loginPolicy/secPolicy')
      .then(res => res.json())
      .then(result => {
        let policy;

        // SecPolicyResponseDto 형태: {success, message, policy}
        if (result && typeof result.success === 'boolean') {
          if (!result.success) {
            alert(result.message || '보안 정책 조회 실패');
            return;
          }
          policy = result.policy;
        } else {
          // 단순 SecPolicyVO 리턴 형태일 때
          policy = result;
        }

        applyPolicyToForm(policy);
      })
      .catch(err => {
        console.error('보안 정책 조회 중 오류', err);
        alert('보안 정책 조회 중 오류가 발생했습니다.');
      });
  }

  // ==========================
  // 4. 폼 → payload 변환
  // ==========================
  function buildPayloadFromForm() {
    // 계정 잠금
    const pwFailCnt = parseInt(document.getElementById('pwFailCnt').value, 10) || null;

    const autoUnlockUse = document.querySelector('input[name="autoUnlockYn"]:checked')?.value === 'Y';
    let autoUnlockTm = 0;
    if (autoUnlockUse) {
      autoUnlockTm = parseInt(document.getElementById('autoUnlockTm').value, 10) || 0;
    }

    // 세션
    const sessionTimeoutMin = parseInt(document.getElementById('sessionTimeoutMin').value, 10) || null;
    const timeoutAction = document.querySelector('input[name="timeoutAction"]:checked')?.value || 't2';

    // 비밀번호 길이
    const pwLenMin = parseInt(document.getElementById('pwLenMin').value, 10) || null;
    const pwLenMax = parseInt(document.getElementById('pwLenMax').value, 10) || null;

    // 비밀번호 규칙
    const useUpperYn = document.getElementById('ruleUpper').checked   ? CODE_Y : CODE_N;
    const useLowerYn = document.getElementById('ruleLower').checked   ? CODE_Y : CODE_N;
    const useNumYn   = document.getElementById('ruleNumber').checked  ? CODE_Y : CODE_N;
    const useSpclYn  = document.getElementById('ruleSpecial').checked ? CODE_Y : CODE_N;

    // OTP
    const otpUse = document.querySelector('input[name="otpYn"]:checked')?.id === 'otpY';
    const otpYn = otpUse ? CODE_Y : CODE_N;
    const otpValidMin = parseInt(document.getElementById('otpValidMin').value, 10) || null;
    const otpFailCnt  = parseInt(document.getElementById('otpFailCnt').value, 10)  || null;

    // CAPTCHA
    const captchaUse = document.querySelector('input[name="captchaYn"]:checked')?.id === 'captchaY';
    const captchaYn = captchaUse ? CODE_Y : CODE_N;
    const captchaFailCnt = parseInt(document.getElementById('captchaFailCnt').value, 10) || null;

    return {
      pwFailCnt,
      autoUnlockTm,
      pwLenMin,
      pwLenMax,
      useUpperYn,
      useLowerYn,
      useNumYn,
      useSpclYn,
      captchaYn,
      captchaFailCnt,
      otpYn,
      otpValidMin,
      otpFailCnt,
      sessionTimeoutMin,
      timeoutAction
    };
  }

  // ==========================
  // 5. 프론트 단 유효성 검증
  // ==========================
  function validatePayload(p) {

    // 1) 로그인 실패 허용 횟수 3~10
    if (p.pwFailCnt == null || p.pwFailCnt < 3 || p.pwFailCnt > 10) {
      return '로그인 실패 허용 횟수는 3~10회 사이로 입력해주세요.';
    }

    // 2) 자동 잠금 해제 시간
    const autoUse = document.querySelector('input[name="autoUnlockYn"]:checked')?.value === 'Y';
    if (autoUse) {
      if (p.autoUnlockTm == null || p.autoUnlockTm < 1 || p.autoUnlockTm > 120) {
        return '잠금 유지 시간은 자동 해제 사용 시 1~120분 사이로 입력해주세요.';
      }
    } else {
      // 미사용이면 0 고정
      p.autoUnlockTm = 0;
    }

    // 3) 비밀번호 길이
    if (p.pwLenMin == null || p.pwLenMax == null) {
      return '비밀번호 최소/최대 길이를 모두 입력해주세요.';
    }
    if (p.pwLenMin < 8 || p.pwLenMin > 30) {
      return '비밀번호 최소 길이는 8~30자 사이로 설정해주세요.';
    }
    if (p.pwLenMax < 8 || p.pwLenMax > 30) {
      return '비밀번호 최대 길이는 8~30자 사이로 설정해주세요.';
    }
    if (p.pwLenMin > p.pwLenMax) {
      return '비밀번호 최소 길이는 최대 길이보다 클 수 없습니다.';
    }

    // 4) 세션 타임아웃 15~120
    if (p.sessionTimeoutMin == null || p.sessionTimeoutMin < 15 || p.sessionTimeoutMin > 120) {
      return '세션 타임 아웃은 15~120분 사이로 설정해주세요.';
    }

    // 5) OTP
    const otpUse = p.otpYn === CODE_Y;
    if (otpUse) {
      if (p.otpValidMin == null || p.otpValidMin < 1 || p.otpValidMin > 30) {
        return 'OTP 유효 시간은 1~30분 사이로 설정해주세요.';
      }
      if (p.otpFailCnt == null || p.otpFailCnt < 1 || p.otpFailCnt > 10) {
        return 'OTP 최대 실패 횟수는 1~10회 사이로 설정해주세요.';
      }
    }

    // 6) CAPTCHA
    const captchaUse = p.captchaYn === CODE_Y;
    if (captchaUse) {
      if (p.captchaFailCnt == null || p.captchaFailCnt < 0 || p.captchaFailCnt > 5) {
        return 'CAPTCHA 요구 실패 횟수는 0~5회 사이로 설정해주세요.';
      }
    }

    return null; // 에러 없음
  }

  // ==========================
  // 6. 저장 (POST)
  // ==========================
  function saveSecPolicy() {
    const payload = buildPayloadFromForm();

    const err = validatePayload(payload);
    if (err) {
      alert(err);
      return;
    }

    fetch('/loginPolicy/secPolicy', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json;charset=UTF-8'
        // CSRF 사용 중이면 여기에서 'X-CSRF-TOKEN' 추가
      },
      body: JSON.stringify(payload)
    })
      .then(res => res.json())
      .then(result => {

        // 응답이 SecPolicyResponseDto 형태일 때
        if (result && typeof result.success === 'boolean') {
          if (!result.success) {
            alert(result.message || '보안 정책 저장 실패');
            return;
          }
          alert(result.message || '보안 정책이 저장되었습니다.');

          if (result.policy) {
            applyPolicyToForm(result.policy);
          }
          return;
        }

        // 단순 SecPolicyVO 리턴 형태일 때
        alert('보안 정책이 저장되었습니다.');
        applyPolicyToForm(result);
      })
      .catch(err => {
        console.error('보안 정책 저장 중 오류', err);
        alert('보안 정책 저장 중 오류가 발생했습니다.');
      });
  }

  // ==========================
  // 7. 초기 바인딩
  // ==========================
  document.addEventListener('DOMContentLoaded', function () {

    // 라디오 변경 시 토글 연결
    document.querySelectorAll('input[name="autoUnlockYn"]').forEach(function (r) {
      r.addEventListener('change', toggleAutoUnlock);
    });

    document.querySelectorAll('input[name="otpYn"]').forEach(function (r) {
      r.addEventListener('change', toggleOtpDetail);
    });

    document.querySelectorAll('input[name="captchaYn"]').forEach(function (r) {
      r.addEventListener('change', toggleCaptchaDetail);
    });

    // 숫자 인풋 범위/키 제한 설정
    [
      'pwFailCnt',
      'autoUnlockTm',
      'sessionTimeoutMin',
      'pwLenMin',
      'pwLenMax',
      'otpValidMin',
      'otpFailCnt',
      'captchaFailCnt'
    ].forEach(setupNumberInputGuard);

    // 버튼 이벤트
    const btnSave = document.getElementById('btnSave');
    if (btnSave) {
      btnSave.addEventListener('click', saveSecPolicy);
    }

    const btnReset = document.getElementById('btnReset');
    if (btnReset) {
      btnReset.addEventListener('click', function () {
        // 기본 정책 값으로 초기화 (DB 값 아님)
        applyPolicyToForm(DEFAULT_POLICY);
      });
    }

    // 초기 토글 상태
    toggleAutoUnlock();
    toggleOtpDetail();
    toggleCaptchaDetail();

    // 페이지 진입 시 서버 값 로드
    loadSecPolicy();
  });

})();
</script>



</body>
</html>
