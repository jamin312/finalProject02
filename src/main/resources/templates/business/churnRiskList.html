<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>churn_risk_list</title>
<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
  <!-- ✅ layout이 head에 합쳐줄 fragment -->
  <th:block layout:fragment="css">
    <style>
      .churn-stdr-wrapper .help-text{
        font-size: 12px;
        color: #868e96;
        font-weight: 400;
        opacity: 0.9;
        line-height: 1.3;
        white-space: normal;
        margin-left: 6px;
      }

      .churn-stdr-wrapper .card-header-left{
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .churn-stdr-wrapper .card-header-left .card-title{
        margin-bottom: 0;
        white-space: nowrap;
      }
    </style>
  </th:block>
</head>

<body layout:fragment="content">

<div class="churn-stdr-wrapper">
	<form th:action="@{/churnRiskList}" method="post" th:object="${cond}">
		<div class="row">
			<div class="col-md-12 mb-3">
				<div class="card">

					<div class="card-header">
						<div class="card-header-left">
							<h5 class="card-title">조회조건</h5>
						</div>
						<div class="card-header-right">
							<button class="btn btn-dark" type="reset">초기화</button>
							<button class="btn btn-outline-dark" type="submit">조회</button>
						</div>
					</div>

					<div class="card-body">
						<div class="row mb-2">
							<div class="col-md-3">
								<label class="form-label">업체명</label>
								<input type="text" class="form-control" placeholder="업체명"
								       th:field="*{customerId}">
							</div>

							<div class="col-md-3">
								<label class="form-label">휴면/이탈</label>
								<select class="form-select" th:field="*{customerStatus}">
									<option value="">전체</option>
									<option value="휴면">휴면</option>
									<option value="이탈">이탈</option>
								</select>
							</div>

							<div class="col-md-3">
								<label class="form-label">거래중단기간점수</label>
								<input type="number" class="form-control"
								       placeholder="입력한 점수 이상의 고객을 조회합니다"
								       th:field="*{trendScore}">
							</div>
						</div>

						<div class="row mb-2">
							<div class="col-md-3">
								<label class="form-label">매출변동점수</label>
								<input type="number" class="form-control"
								       placeholder="입력한 점수 이상의 고객을 조회합니다"
								       th:field="*{recScore}">
							</div>

							<div class="col-md-3">
								<label class="form-label">평균 구매주기점수</label>
								<input type="number" class="form-control"
								       placeholder="입력한 점수 이상의 고객을 조회합니다"
								       th:field="*{freqScore}">
							</div>

							<div class="col-md-3">
								<label class="form-label">이탈위험점수</label>
								<input type="number" class="form-control"
								       placeholder="입력한 점수 이상의 고객을 조회합니다"
								       th:field="*{finalScore}">
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>
	</form>

	<div class="card mb-3">
		<div class="card-header">
			<div class="card-header-left">
				<h5 class="card-title">휴먼고객목록</h5>
				<span class="help-text churn-help">* 휴면: 40점이상, 주의: 60점이상, 이탈위험: 80점이상</span>
			</div>
		</div>
		<div class="card-body">
			<div id="dormancygrid" style="height: 300px; width: 100%; overflow-y: auto; overflow-x: auto;"></div>
		</div>
	</div>
</div>

















	<script th:inline="javascript">
		tui.Grid.applyTheme('default', {
			cell : {
				normal : { border : '#ccc', background : "#fff", showVerticalBorder : true },
				header : { border : '#ccc', background : '#E3E6ED', showVerticalBorder : true },
				editable : { background : '#FFFDF0', text : '#000' },
				selectedHeader : { background : '#E3E6ED' },
				selected : { background : '#ffffff' }
			}
		});

		const dormancygridData = /*[[${getMonthlySalesList}]]*/ [];
		console.log('dormancygridData', dormancygridData);

		const dormancygrid = new tui.Grid({
			el : document.getElementById('dormancygrid'),
			data : dormancygridData,
			scrollX : false,
			scrollY : true,
			minBodyHeight : 0,
			autoWidth : true,
			columns : [ {
				  header : '업체명',
				  name : 'custcomName',
				  sortable : true,
				  align: 'center'
				}, {
				  header : '업체코드',
				  name : 'customerId',
				  sortable : true,
				}, {
				  header : '휴면/이탈',
				  name : 'customerStatus',
				  sortable : true,
				  align: 'center'
				}, {
				  header : '거래중단기간(점수)',
				  name : 'recScore',
				  align : 'center',
				  formatter: ({ value }) => value != null ? value + '점' : ''
				}, {
				  header : '매출변동(점수)',
				  name : 'trendScore',
				  align : 'center',
				  formatter: ({ value }) => value != null ? value + '점' : ''
				}, {
				  header : '평균구매주기(점수)',
				  name : 'freqScore',
				  align : 'center',
				  formatter: ({ value }) => value != null ? value + '점' : ''
				}, {
				  header : '이탈위험점수',
				  name : 'finalScore',
				  align : 'center',
				  formatter: ({ value }) => value != null ? value + '점' : ''
				} ]

		});
	</script>

</body>
</html>
